(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Wfs=e()}})(function(){var e,t,r;return function(){function c(a,o,s){function u(r,e){if(!o[r]){if(!a[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(f)return f(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[r]={exports:{}};a[r][0].call(i.exports,function(e){var t=a[r][1][e];return u(t||e)},i,i.exports,c,a,o,s)}return o[r].exports}for(var f="function"==typeof require&&require,e=0;e<s.length;e++)u(s[e]);return u}return c}()({1:[function(e,t,r){"use strict";var n=typeof Reflect==="object"?Reflect:null;var l=n&&typeof n.apply==="function"?n.apply:function e(t,r,n){return Function.prototype.apply.call(t,r,n)};var i;if(n&&typeof n.ownKeys==="function"){i=n.ownKeys}else if(Object.getOwnPropertySymbols){i=function e(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}}else{i=function e(t){return Object.getOwnPropertyNames(t)}}function u(e){if(console&&console.warn)console.warn(e)}var a=Number.isNaN||function e(t){return t!==t};function o(){o.init.call(this)}t.exports=o;t.exports.once=_;o.EventEmitter=o;o.prototype._events=undefined;o.prototype._eventsCount=0;o.prototype._maxListeners=undefined;var s=10;function f(e){if(typeof e!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:true,get:function(){return s},set:function(e){if(typeof e!=="number"||e<0||a(e)){throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".")}s=e}});o.init=function(){if(this._events===undefined||this._events===Object.getPrototypeOf(this)._events){this._events=Object.create(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined};o.prototype.setMaxListeners=function e(t){if(typeof t!=="number"||t<0||a(t)){throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".")}this._maxListeners=t;return this};function c(e){if(e._maxListeners===undefined)return o.defaultMaxListeners;return e._maxListeners}o.prototype.getMaxListeners=function e(){return c(this)};o.prototype.emit=function e(t){var r=[];for(var n=1;n<arguments.length;n++)r.push(arguments[n]);var i=t==="error";var a=this._events;if(a!==undefined)i=i&&a.error===undefined;else if(!i)return false;if(i){var o;if(r.length>0)o=r[0];if(o instanceof Error){throw o}var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));s.context=o;throw s}var u=a[t];if(u===undefined)return false;if(typeof u==="function"){l(u,this,r)}else{var f=u.length;var c=m(u,f);for(var n=0;n<f;++n)l(c[n],this,r)}return true};function d(e,t,r,n){var i;var a;var o;f(r);a=e._events;if(a===undefined){a=e._events=Object.create(null);e._eventsCount=0}else{if(a.newListener!==undefined){e.emit("newListener",t,r.listener?r.listener:r);a=e._events}o=a[t]}if(o===undefined){o=a[t]=r;++e._eventsCount}else{if(typeof o==="function"){o=a[t]=n?[r,o]:[o,r]}else if(n){o.unshift(r)}else{o.push(r)}i=c(e);if(i>0&&o.length>i&&!o.warned){o.warned=true;var s=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners "+"added. Use emitter.setMaxListeners() to "+"increase limit");s.name="MaxListenersExceededWarning";s.emitter=e;s.type=t;s.count=o.length;u(s)}}return e}o.prototype.addListener=function e(t,r){return d(this,t,r,false)};o.prototype.on=o.prototype.addListener;o.prototype.prependListener=function e(t,r){return d(this,t,r,true)};function h(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;if(arguments.length===0)return this.listener.call(this.target);return this.listener.apply(this.target,arguments)}}function p(e,t,r){var n={fired:false,wrapFn:undefined,target:e,type:t,listener:r};var i=h.bind(n);i.listener=r;n.wrapFn=i;return i}o.prototype.once=function e(t,r){f(r);this.on(t,p(this,t,r));return this};o.prototype.prependOnceListener=function e(t,r){f(r);this.prependListener(t,p(this,t,r));return this};o.prototype.removeListener=function e(t,r){var n,i,a,o,s;f(r);i=this._events;if(i===undefined)return this;n=i[t];if(n===undefined)return this;if(n===r||n.listener===r){if(--this._eventsCount===0)this._events=Object.create(null);else{delete i[t];if(i.removeListener)this.emit("removeListener",t,n.listener||r)}}else if(typeof n!=="function"){a=-1;for(o=n.length-1;o>=0;o--){if(n[o]===r||n[o].listener===r){s=n[o].listener;a=o;break}}if(a<0)return this;if(a===0)n.shift();else{b(n,a)}if(n.length===1)i[t]=n[0];if(i.removeListener!==undefined)this.emit("removeListener",t,s||r)}return this};o.prototype.off=o.prototype.removeListener;o.prototype.removeAllListeners=function e(t){var r,n,i;n=this._events;if(n===undefined)return this;if(n.removeListener===undefined){if(arguments.length===0){this._events=Object.create(null);this._eventsCount=0}else if(n[t]!==undefined){if(--this._eventsCount===0)this._events=Object.create(null);else delete n[t]}return this}if(arguments.length===0){var a=Object.keys(n);var o;for(i=0;i<a.length;++i){o=a[i];if(o==="removeListener")continue;this.removeAllListeners(o)}this.removeAllListeners("removeListener");this._events=Object.create(null);this._eventsCount=0;return this}r=n[t];if(typeof r==="function"){this.removeListener(t,r)}else if(r!==undefined){for(i=r.length-1;i>=0;i--){this.removeListener(t,r[i])}}return this};function v(e,t,r){var n=e._events;if(n===undefined)return[];var i=n[t];if(i===undefined)return[];if(typeof i==="function")return r?[i.listener||i]:[i];return r?g(i):m(i,i.length)}o.prototype.listeners=function e(t){return v(this,t,true)};o.prototype.rawListeners=function e(t){return v(this,t,false)};o.listenerCount=function(e,t){if(typeof e.listenerCount==="function"){return e.listenerCount(t)}else{return y.call(e,t)}};o.prototype.listenerCount=y;function y(e){var t=this._events;if(t!==undefined){var r=t[e];if(typeof r==="function"){return 1}else if(r!==undefined){return r.length}}return 0}o.prototype.eventNames=function e(){return this._eventsCount>0?i(this._events):[]};function m(e,t){var r=new Array(t);for(var n=0;n<t;++n)r[n]=e[n];return r}function b(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function g(e){var t=new Array(e.length);for(var r=0;r<t.length;++r){t[r]=e[r].listener||e[r]}return t}function _(i,a){return new Promise(function(e,t){function r(e){i.removeListener(a,n);t(e)}function n(){if(typeof i.removeListener==="function"){i.removeListener("error",r)}e([].slice.call(arguments))}E(i,a,n,{once:true});if(a!=="error"){w(i,r,{once:true})}})}function w(e,t,r){if(typeof e.on==="function"){E(e,"error",t,r)}}function E(r,n,i,a){if(typeof r.on==="function"){if(a.once){r.once(n,i)}else{r.on(n,i)}}else if(typeof r.addEventListener==="function"){r.addEventListener(n,function e(t){if(a.once){r.removeEventListener(n,e)}i(t)})}else{throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}}},{}],2:[function(e,t,r){var n=t.exports={};var i;var a;function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){i=setTimeout}else{i=o}}catch(e){i=o}try{if(typeof clearTimeout==="function"){a=clearTimeout}else{a=s}}catch(e){a=s}})();function u(t){if(i===setTimeout){return setTimeout(t,0)}if((i===o||!i)&&setTimeout){i=setTimeout;return setTimeout(t,0)}try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}function f(t){if(a===clearTimeout){return clearTimeout(t)}if((a===s||!a)&&clearTimeout){a=clearTimeout;return clearTimeout(t)}try{return a(t)}catch(e){try{return a.call(null,t)}catch(e){return a.call(this,t)}}}var c=[];var l=false;var d;var h=-1;function p(){if(!l||!d){return}l=false;if(d.length){c=d.concat(c)}else{h=-1}if(c.length){v()}}function v(){if(l){return}var e=u(p);l=true;var t=c.length;while(t){d=c;c=[];while(++h<t){if(d){d[h].run()}}h=-1;t=c.length}d=null;l=false;f(e)}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1){for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}}c.push(new y(e,t));if(c.length===1&&!l){u(v)}};function y(e,t){this.fun=e;this.array=t}y.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function m(){}n.on=m;n.addListener=m;n.once=m;n.off=m;n.removeListener=m;n.removeAllListeners=m;n.emit=m;n.prependListener=m;n.prependOnceListener=m;n.listeners=function(e){return[]};n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,s(n.key),n)}}function o(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function s(e){var t=u(e,"string");return"symbol"==i(t)?t:String(t)}function u(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var f=function(){function l(e){n(this,l);this.remuxer=e;this.track=e.mp4track}o(l,[{key:"extractAAC",value:function e(t){var r=0,n=t.byteLength,i=[],a,o;if(!l.isAACPattern(t)){return i}a=l.getHeaderLength(t);if(!this.aacHeader){this.aacHeader=t.subarray(0,a)}while(r<n){o=l.getFrameLength(t);i.push(t.subarray(a,o));t=t.slice(o);r+=o}return i}},{key:"setAACConfig",value:function e(t){var r,n,i,a=new Uint8Array(2),o=this.aacHeader;if(!o)return;r=((o[2]&192)>>>6)+1;n=l.getSampleRateIndex(t);i=(o[2]&1)<<2;i|=(o[3]&192)>>>6;a[0]=r<<3;a[0]|=(n&14)>>1;a[1]|=(n&1)<<7;a[1]|=i<<3;this.track.codec="mp4a.40."+r;this.track.channelCount=i;this.track.config=a;this.track.duration=1024/t*this.track.timescale;this.track.audioSampleRate=t}}],[{key:"samplingRateMap",get:function e(){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]}},{key:"getHeaderLength",value:function e(t){return t[1]&1?7:9}},{key:"getSampleRateIndex",value:function e(t){var r=l.samplingRateMap;var n=0;for(;n<r.length;++n){if(r[n]===t){return n}}return n}},{key:"getFrameLength",value:function e(t){return(t[3]&3)<<11|t[4]<<3|(t[5]&224)>>>5}},{key:"isAACPattern",value:function e(t){return t[0]===255&&(t[1]&240)===240&&(t[1]&6)===0}},{key:"appendByteArray",value:function e(t,r){var n=new Uint8Array((t.byteLength|0)+(r.byteLength|0));n.set(t,0);n.set(r,t.byteLength|0);return n}},{key:"parseAACConfig",value:function e(t,r){if(!l.isAACPattern(t)){return null}var n=l.getHeaderLength(t);var i=t.subarray(0,n);var a,o,s,u=new Uint8Array(2),f=i;a=((f[2]&192)>>>6)+1;o=l.getSampleRateIndex(r);s=(f[2]&1)<<2;s|=(f[3]&192)>>>6;u[0]=a<<3;u[0]|=(o&14)>>1;u[1]|=(o&1)<<7;u[1]|=s<<3;var c={headerLength:n,sampleRate:r,channelCount:s,config:u};return c}}]);return l}();var c=r.default=f},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var n=i(e("./aac-parser.js"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){"@babel/helpers - typeof";return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,f(n.key),n)}}function u(e,t,r){if(t)s(e.prototype,t);if(r)s(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function f(e){var t=c(e,"string");return"symbol"==a(t)?t:String(t)}function c(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var l=function(){function r(e,t){o(this,r);this.readyToDecode=false;this.nextDts=0;this.dts=0;this.mp4track={id:2,type:"audio",channelCount:0,len:0,fragmented:true,timescale:t,duration:0,samples:[],config:"",codec:""};this.wfs=e;this.samples=[];this.aacParser=new n.default(this)}u(r,[{key:"resetTrack",value:function e(){this.readyToDecode=false;this.mp4track.codec="";this.mp4track.channelCount="";this.mp4track.config="";this.mp4track.timescale=this.timescale;this.nextDts=0;this.dts=0;this.samples=[]}},{key:"resetSamples",value:function e(){this.mp4track.len=0;this.samples=[]}},{key:"remux",value:function e(t){if(t.length>0){if(!this.readyToDecode){this.aacParser.setAACConfig(this.wfs.audioInfo.sampleRate);this.readyToDecode=true}for(var r=0;r<t.length;r++){var n=t[r];var i=n.units;var a=i.byteLength;this.samples.push({units:i,size:a,duration:this.mp4track.duration});this.mp4track.len+=a}}}},{key:"getPayload",value:function e(){if(this.mp4track.len==0){return null}var t=new Uint8Array(this.mp4track.len);var r=0;var n=this.mp4track.samples;var i;this.dts=this.nextDts;while(this.samples.length){var a=this.samples.shift();var o=a.duration;if(o<=0){this.mp4track.len-=a.size;continue}this.nextDts+=o;i={size:a.size,duration:o,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};t.set(a.units,r);r+=a.size;n.push(i)}if(!n.length)return null;return new Uint8Array(t.buffer,0,this.mp4track.len)}},{key:"getAacParser",value:function e(){return this.aacParser}}]);return r}();var d=r.default=l},{"./aac-parser.js":3}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,s(n.key),n)}}function o(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function s(e){var t=u(e,"string");return"symbol"==i(t)?t:String(t)}function u(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var f=function(){function t(e){n(this,t);this.sourceBuffer=e;this.type="audio";this.appending=false;this.onsbue=this.onSBUpdateEnd.bind(this);this.sourceBuffer.addEventListener("updateend",this.onsbue);this.segments=[]}o(t,[{key:"appendBuffer",value:function e(t){this.segments.push(t);this.doAppending()}},{key:"onSBUpdateEnd",value:function e(t){this.appending=false;this.doAppending()}},{key:"doAppending",value:function e(){var t=this.sourceBuffer,r=this.segments;if(this.appending){return}if(r&&r.length){var n=r.shift();try{if(t){t.appendBuffer(n.data);this.appendError=0;this.appended++;this.appending=true}}catch(e){}}}}]);return t}();var c=r.default=f},{}],6:[function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var s=f(e("../events"));var a=f(e("../event-handler"));var o=f(e("./aac-remuxer"));var u=f(e("../remux/mp4-generator"));var n=f(e("./aac-parser"));function f(e){return e&&e.__esModule?e:{default:e}}function c(t,e){var r=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=l(t))||e&&t&&typeof t.length==="number"){if(r)t=r;var n=0;var i=function e(){};return{s:i,n:function e(){if(n>=t.length)return{done:true};return{done:false,value:t[n++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,o=false,s;return{s:function e(){r=r.call(t)},n:function e(){var t=r.next();a=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!a&&r.return!=null)r.return()}finally{if(o)throw s}}}}function l(e,t){if(!e)return;if(typeof e==="string")return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}function d(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,y(n.key),n)}}function v(e,t,r){if(t)p(e.prototype,t);if(r)p(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function y(e){var t=m(e,"string");return"symbol"==i(t)?t:String(t)}function m(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function b(e,t,r){return t=E(t),g(e,w()?Reflect.construct(t,r||[],E(e).constructor):t.apply(e,r))}function g(e,t){if(t&&(i(t)==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return _(e)}function _(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function w(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(w=function e(){return!!t})()}function E(e){E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return E(e)}function S(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)A(e,t)}function A(e,t){A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return A(e,t)}var T=function(e){S(n,e);function n(e){var t;h(this,n);t=b(this,n,[e,s.default.AUDIO_DATA_PARSING,s.default.AUDIO_DATA_REMUXER]);t.observer=t.wfs;t.readyToDecode=false;t.timescale=t.wfs.config.timescale;var r=new o.default(e,t.timescale);t.aacParser=r.getAacParser();t.audioRemuxer=r;t.lastPTS=0;return t}v(n,[{key:"destroy",value:function e(){a.default.prototype.destroy.call(this)}},{key:"onAudioDataParsing",value:function e(t){var r=this.audioRemuxer;if(!this.wfs.config.videoReady){r.resetSamples()}this.lastPTS=t.pts;var n=this.aacParser.extractAAC(t.data);if(n.length>0){var i=this.getAudioFrames(n,r.mp4track.duration);r.remux(i)}this.onAudioDataRemuxer(null)}},{key:"onAudioDataRemuxer",value:function e(t){var r=this.audioRemuxer;if(!this.wfs.config.videoReady){return}var n=r.getPayload();if(!n){return}if(!this.readyToDecode){this.initSegment()}if(n.byteLength){var i=u.default.moof(this.seq++,r.dts,r.mp4track);var a=u.default.mdat(n);var o={type:"audio",data1:i,data2:a};this.observer.trigger(s.default.FRAG_PARSING_DATA,o);r.mp4track.samples=[];r.mp4track.len=0}}},{key:"getAudioFrames",value:function e(t,r){var n=[];var i=c(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.push({units:o})}}catch(e){i.e(e)}finally{i.f()}n.map(function(e){e.duration=r});return n}},{key:"initSegment",value:function e(){var t=this.audioRemuxer;var r={};r.audio={initSegment:u.default.initSegment([t.mp4track])};this.observer.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,{tracks:r});this.readyToDecode=true}}]);return n}(a.default);var k=r.default=T},{"../event-handler":13,"../events":14,"../remux/mp4-generator":23,"./aac-parser":3,"./aac-remuxer":4}],7:[function(e,t,r){"use strict";function D(e){"@babel/helpers - typeof";return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var u=e("../errors");var l=o(e("../events"));var n=o(e("../event-handler"));var i=o(e("./audio-demuxer"));var a=o(e("../utils/libfaac"));function o(e){return e&&e.__esModule?e:{default:e}}function C(){"use strict";C=function e(){return o};var f,o={},e=Object.prototype,c=e.hasOwnProperty,l=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},i=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function a(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(f){a=function e(t,r,n){return t[r]=n}}function s(e,t,r,n){var i=t&&t.prototype instanceof u?t:u,a=Object.create(i.prototype),o=new O(n||[]);return l(a,"_invoke",{value:k(e,r,o)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=s;var h="suspendedStart",p="suspendedYield",v="executing",y="completed",m={};function u(){}function b(){}function g(){}var _={};a(_,i,function(){return this});var w=Object.getPrototypeOf,E=w&&w(w(x([])));E&&E!==e&&c.call(E,i)&&(_=E);var S=g.prototype=u.prototype=Object.create(_);function A(e){["next","throw","return"].forEach(function(t){a(e,t,function(e){return this._invoke(t,e)})})}function T(s,u){function f(e,t,r,n){var i=d(s[e],s,t);if("throw"!==i.type){var a=i.arg,o=a.value;return o&&"object"==D(o)&&c.call(o,"__await")?u.resolve(o.__await).then(function(e){f("next",e,r,n)},function(e){f("throw",e,r,n)}):u.resolve(o).then(function(e){a.value=e,r(a)},function(e){return f("throw",e,r,n)})}n(i.arg)}var i;l(this,"_invoke",{value:function e(r,n){function t(){return new u(function(e,t){f(r,n,e,t)})}return i=i?i.then(t,t):t()}})}function k(a,o,s){var u=h;return function(e,t){if(u===v)throw new Error("Generator is already running");if(u===y){if("throw"===e)throw t;return{value:f,done:!0}}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var n=R(r,s);if(n){if(n===m)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(u===h)throw u=y,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);u=v;var i=d(a,o,s);if("normal"===i.type){if(u=s.done?y:p,i.arg===m)continue;return{value:i.arg,done:s.done}}"throw"===i.type&&(u=y,s.method="throw",s.arg=i.arg)}}}function R(e,t){var r=t.method,n=e.iterator[r];if(n===f)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=f,R(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=d(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=f),t.delegate=null,m):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function x(t){if(t||""===t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=f,e.done=!0,e};return n.next=n}}throw new TypeError(D(t)+" is not iterable")}return b.prototype=g,l(S,"constructor",{value:g,configurable:!0}),l(g,"constructor",{value:b,configurable:!0}),b.displayName=a(g,n,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,a(e,n,"GeneratorFunction")),e.prototype=Object.create(S),e},o.awrap=function(e){return{__await:e}},A(T.prototype),a(T.prototype,r,function(){return this}),o.AsyncIterator=T,o.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var a=new T(s(e,t,r,n),i);return o.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},A(S),a(S,n,"Generator"),a(S,i,function(){return this}),a(S,"toString",function(){return"[object Generator]"}),o.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=x,O.prototype={constructor:O,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&c.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=f)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(r){if(this.done)throw r;var n=this;function t(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=f),!!t}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return t("end");if(a.tryLoc<=this.prev){var s=c.call(a,"catchLoc"),u=c.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return t(a.catchLoc,!0);if(this.prev<a.finallyLoc)return t(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return t(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return t(a.finallyLoc)}}}},abrupt:function e(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=r&&r<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=r,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function e(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),m},finish:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),m}},catch:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var a=i.arg;L(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function e(t,r,n){return this.delegate={iterator:x(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=f),m}},o}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,d(n.key),n)}}function c(e,t,r){if(t)f(e.prototype,t);if(r)f(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function d(e){var t=h(e,"string");return"symbol"==D(t)?t:String(t)}function h(e,t){if("object"!=D(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=D(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function p(e,t,r){return t=b(t),v(e,m()?Reflect.construct(t,r||[],b(e).constructor):t.apply(e,r))}function v(e,t){if(t&&(D(t)==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return y(e)}function y(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function m(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(m=function e(){return!!t})()}function b(e){b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return b(e)}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)_(e,t)}function _(e,t){_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return _(e,t)}function w(e,t,r,n,i,a,o){try{var s=e[a](o);var u=s.value}catch(e){r(e);return}if(s.done){t(u)}else{Promise.resolve(u).then(n,i)}}function E(s){return function(){var e=this,o=arguments;return new Promise(function(t,r){var n=s.apply(e,o);function i(e){w(n,t,r,i,a,"next",e)}function a(e){w(n,t,r,i,a,"throw",e)}i(undefined)})}}var S=null;function A(){return T.apply(this,arguments)}function T(){T=E(C().mark(function e(){return C().wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return(0,a.default)().then(function(e){S=e});case 2:case"end":return t.stop()}},e)}));return T.apply(this,arguments)}var k=function(e){g(r,e);function r(e){var t;s(this,r);t=p(this,r,[e]);t.audioDemuxer=new i.default(t.wfs);t.pcmModuleOpened=false;t.mediaCode=0;t.audioInfo=t.wfs.audioInfo;t.isForceClosed=false;return t}c(r,[{key:"destroy",value:function e(){console.log("AudioLoader.destroy +++");this.isForceClosed=true;this.unload();!!this.client&&this.client.close();n.default.prototype.destroy.call(this.audioDemuxer);n.default.prototype.destroy.call(this);console.log("AudioLoader.destroy ---")}},{key:"onWSAttaching",value:function e(t){console.log("onAudioWSAttaching:",this.audioInfo.mediaType);this.isForceClosed=false;switch(this.audioInfo.mediaType){case"g711a":A();this.mediaCode=1;break;case"g711u":A();this.mediaCode=2;break;case"lpcm":A();this.mediaCode=3;break;case"aac":default:this.mediaCode=0;break}if(t.websocket instanceof WebSocket){this.client=t.websocket;this.client.onopen=this.initSocketClient.bind(this);this.client.onclose=this.closeSocketClient.bind(this);this.client.onerror=this.errorSocketClient.bind(this)}}},{key:"errorSocketClient",value:function e(t){this.unload();console.log("Audio webSocket error: ",t)}},{key:"closeSocketClient",value:function e(t){this.unload();console.log("Audio websocket closed: ",t)}},{key:"initSocketClient",value:function e(t){this.loaded();console.log("Audio  websocket Open!")}},{key:"pcm_2_aac",value:function e(t){var r=new Uint8Array(t);if(!r||!r.byteLength){console.log("pcm_2_aac input null!");return null}var n=S._malloc(r.byteLength);if(!n){console.log("faacModule._malloc failed!");return null}try{S.HEAPU8.set(r,n);var i=S._pcm_2_aac(n,r.byteLength);var a=S._getByteLen();var o=Uint8Array.from(S.HEAPU8.subarray(i,i+a));S._free(n);S._free_buf(i);return o}catch(e){this.unload();console.log("faacModule _pcm_2_aac failed!");var s={type:u.ErrorTypes.MEDIA_ERROR};s.details=u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR;s.fatal=true;this.wfs.trigger(l.default.ERROR,s)}return o}},{key:"receiveSocketMessage",value:function e(t){if(this.isForceClosed){return}if(this.mediaCode===1||this.mediaCode===2||this.mediaCode===3){if(!S){return}if(!this.pcmModuleOpened){var r=this.mediaCode-1;console.log("faacModule._turn_on_encoder");S._turn_on_encoder(this.audioInfo.numChannels,this.audioInfo.sampleRate,r,this.audioInfo.bitWidth);this.pcmModuleOpened=true}}this.buf=null;var n=new Uint8Array(t.data);var i=new DataView(n.buffer);var a=1414092865;var o=16;var s=i.getUint32(0,true);var u=i.getUint32(4,true);if(s!=a||u+o!==i.byteLength){return}var f=Number(i.getBigUint64(8,true)/BigInt(1e3));var c=n.subarray(o);if(!c||!c.byteLength){return}this.wfs.audioReady=true;if(this.pcmModuleOpened){this.buf=new Uint8Array(this.pcm_2_aac(c))}else{this.buf=new Uint8Array(c)}n=null;c=null;this.wfs.trigger(l.default.AUDIO_DATA_PARSING,{data:this.buf,pts:f});this.wfs.trigger(l.default.AAC_DATA_APPENDING,{data:this.buf,pts:f})}},{key:"closeWS",value:function e(){this.client&&this.client.close();this.client=null}},{key:"loaded",value:function e(){this.client.binaryType="arraybuffer";this.client.onmessage=this.receiveSocketMessage.bind(this);this.audioInfo.client=this.client}},{key:"unload",value:function e(){this.client=null;this.audioInfo.client=this.client}}]);return r}(n.default);var R=r.default=k},{"../errors":12,"../event-handler":13,"../events":14,"../utils/libfaac":25,"./audio-demuxer":6}],8:[function(e,t,r){"use strict";function D(e){"@babel/helpers - typeof";return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var s=e("../errors");var u=a(e("../events"));var n=a(e("../event-handler"));var i=a(e("../utils/mp4-encoder"));var l=a(e("../audio/aac-parser"));var f=a(e("../audio/audio-buffer"));function a(e){return e&&e.__esModule?e:{default:e}}function C(){"use strict";C=function e(){return o};var f,o={},e=Object.prototype,c=e.hasOwnProperty,l=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},i=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function a(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(f){a=function e(t,r,n){return t[r]=n}}function s(e,t,r,n){var i=t&&t.prototype instanceof u?t:u,a=Object.create(i.prototype),o=new O(n||[]);return l(a,"_invoke",{value:k(e,r,o)}),a}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=s;var h="suspendedStart",p="suspendedYield",v="executing",y="completed",m={};function u(){}function b(){}function g(){}var _={};a(_,i,function(){return this});var w=Object.getPrototypeOf,E=w&&w(w(x([])));E&&E!==e&&c.call(E,i)&&(_=E);var S=g.prototype=u.prototype=Object.create(_);function A(e){["next","throw","return"].forEach(function(t){a(e,t,function(e){return this._invoke(t,e)})})}function T(s,u){function f(e,t,r,n){var i=d(s[e],s,t);if("throw"!==i.type){var a=i.arg,o=a.value;return o&&"object"==D(o)&&c.call(o,"__await")?u.resolve(o.__await).then(function(e){f("next",e,r,n)},function(e){f("throw",e,r,n)}):u.resolve(o).then(function(e){a.value=e,r(a)},function(e){return f("throw",e,r,n)})}n(i.arg)}var i;l(this,"_invoke",{value:function e(r,n){function t(){return new u(function(e,t){f(r,n,e,t)})}return i=i?i.then(t,t):t()}})}function k(a,o,s){var u=h;return function(e,t){if(u===v)throw new Error("Generator is already running");if(u===y){if("throw"===e)throw t;return{value:f,done:!0}}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var n=R(r,s);if(n){if(n===m)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(u===h)throw u=y,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);u=v;var i=d(a,o,s);if("normal"===i.type){if(u=s.done?y:p,i.arg===m)continue;return{value:i.arg,done:s.done}}"throw"===i.type&&(u=y,s.method="throw",s.arg=i.arg)}}}function R(e,t){var r=t.method,n=e.iterator[r];if(n===f)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=f,R(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var i=d(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=f),t.delegate=null,m):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function x(t){if(t||""===t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=f,e.done=!0,e};return n.next=n}}throw new TypeError(D(t)+" is not iterable")}return b.prototype=g,l(S,"constructor",{value:g,configurable:!0}),l(g,"constructor",{value:b,configurable:!0}),b.displayName=a(g,n,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,a(e,n,"GeneratorFunction")),e.prototype=Object.create(S),e},o.awrap=function(e){return{__await:e}},A(T.prototype),a(T.prototype,r,function(){return this}),o.AsyncIterator=T,o.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var a=new T(s(e,t,r,n),i);return o.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},A(S),a(S,n,"Generator"),a(S,i,function(){return this}),a(S,"toString",function(){return"[object Generator]"}),o.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},o.values=x,O.prototype={constructor:O,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&c.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=f)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(r){if(this.done)throw r;var n=this;function t(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=f),!!t}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return t("end");if(a.tryLoc<=this.prev){var s=c.call(a,"catchLoc"),u=c.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return t(a.catchLoc,!0);if(this.prev<a.finallyLoc)return t(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return t(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return t(a.finallyLoc)}}}},abrupt:function e(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&c.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=r&&r<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=r,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function e(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),m},finish:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),m}},catch:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var a=i.arg;L(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function e(t,r,n){return this.delegate={iterator:x(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=f),m}},o}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,h(n.key),n)}}function d(e,t,r){if(t)c(e.prototype,t);if(r)c(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function h(e){var t=p(e,"string");return"symbol"==D(t)?t:String(t)}function p(e,t){if("object"!=D(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=D(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function v(e,t,r){return t=b(t),y(e,m()?Reflect.construct(t,r||[],b(e).constructor):t.apply(e,r))}function y(e,t){if(t&&(D(t)==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return g(e)}function m(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(m=function e(){return!!t})()}function b(e){b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return b(e)}function g(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function _(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)w(e,t)}function w(e,t){w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return w(e,t)}function E(e,t,r,n,i,a,o){try{var s=e[a](o);var u=s.value}catch(e){r(e);return}if(s.done){t(u)}else{Promise.resolve(u).then(n,i)}}function S(s){return function(){var e=this,o=arguments;return new Promise(function(t,r){var n=s.apply(e,o);function i(e){E(n,t,r,i,a,"next",e)}function a(e){E(n,t,r,i,a,"throw",e)}i(undefined)})}}var A=null;function T(){return k.apply(this,arguments)}function k(){k=S(C().mark(function e(){return C().wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return(0,i.default)().then(function(e){A=e});case 2:case"end":return t.stop()}},e)}));return k.apply(this,arguments)}var R=function(e){_(r,e);function r(e){var t;o(this,r);t=v(this,r,[e,u.default.MEDIA_ATTACHING,u.default.BUFFER_APPENDING,u.default.BUFFER_RESET,u.default.RECORDING_START,u.default.RECORDING_STOP,u.default.H264_DATA_APPENDING,u.default.AAC_DATA_APPENDING,u.default.PLAYER_SEEK_NOW]);t.config=t.wfs.config;t.rec_threshold_total=16*(1024*1024*1024);t.rec_threshold_single=1*(1024*1024*1024);t.rec_timer=undefined;t.rec_file="";t.rec_result_cb=undefined;t.rec_state_cb=undefined;t.mediaElement=undefined;t.mediaSource=undefined;t.mediaSize=0;t.sourceBuffers={};t.segments=[];t.h264Frames=[];t.aacFrames=[];t.aac_config=null;t.mp4Encoder=undefined;t.appended=0;t.mediaErrorCount=0;t.count=0;t.onsbue=t.onSBUpdateEnd.bind(g(t));t.browserType=0;t.mediaType="";t.websocketName=undefined;t._fs=null;t.track_info={width:0,height:0};t.last_pts={audio:0,video:0};T();t.mp4BlobBuffer=[];t.needSeek=true;return t}d(r,[{key:"destroy",value:function e(){n.default.prototype.destroy.call(this)}},{key:"pad2",value:function e(t){return t<10?"0"+t:t}},{key:"onRecordingProc",value:function e(){var r=this;if(r._fs==null){if(r.rec_result_cb){r.rec_result_cb(false)}console.log("fs is not authorized");return}if(r.rec_timer){clearInterval(r.rec_timer);r.rec_timer=undefined}r.count=0;r.rec_timer=setInterval(function(){if(r.appended>10){clearInterval(r.rec_timer);r.rec_timer=undefined;var e=new Date;var t=1900+e.getYear()+"-"+r.pad2(e.getMonth()+1)+"-"+r.pad2(e.getDate())+"_"+r.pad2(e.getHours())+"-"+r.pad2(e.getMinutes())+"-"+r.pad2(e.getSeconds());r.rec_file="ax_"+t+".mp4";console.log("MediaRecorder started: "+r.rec_file);r.mediaSize=0;r.config.recording=true;if(r.rec_result_cb){r.rec_result_cb(true)}}else{r.count++}if(r.count>=10){clearInterval(r.rec_timer);r.rec_timer=undefined;if(r.rec_result_cb){r.rec_result_cb(false)}}},1e3)}},{key:"onRecordingStart",value:function e(t){if(this.config.recording){console.log("recording is in progress");return}if(t!=undefined){this.rec_threshold_single=t.rec_file_threshold;this.rec_result_cb=t.result_cb;this.rec_state_cb=t.state_cb}this.last_pts={audio:0,video:0};var r=this;navigator.webkitPersistentStorage.queryUsageAndQuota(function(e,t){if(t==""){r.requestFs()}else{window.webkitRequestFileSystem(window.PERSISTENT,r.rec_threshold_total,function(e){r._fs=e;e.root.getDirectory("ax_video",{create:true},function(e){console.log("Directory: "+e.name+" fs requested");r.onRecordingProc()},r.errorHandler)})}},this.errorHandler)}},{key:"onRecordingStop",value:function e(){this.config.recording=false;if(this.rec_timer){clearInterval(this.rec_timer);this.rec_timer=undefined}this.saveToMP4Blob();this.h264Frames=[];this.aacFrames=[]}},{key:"errorHandler",value:function e(t){var r="An error occured(errcd): ";console.log(r+t.code)}},{key:"requestFs",value:function e(){var t=this;navigator.webkitPersistentStorage.requestQuota(this.rec_threshold_total,function(e){if(e<1){if(t.rec_result_cb){t.rec_result_cb(false)}return}window.webkitRequestFileSystem(window.PERSISTENT,e,function(e){t._fs=e;e.root.getDirectory("ax_video",{create:true},function(e){console.log("Directory: "+e.name+" exists or just created.");t.onRecordingProc()},t.errorHandler)})})}},{key:"onMediaAttaching",value:function e(t){this.mediaElement=t.media.video;if(this.mediaElement===undefined){this.mediaElement=t.media}var r=this.mediaElement;this.mediaType=t.mediaType;this.websocketName=t.websocketName;console.log("onMediaAttaching: mediaType="+this.mediaType);if(r){var n=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);n.addEventListener("sourceopen",this.onmso);n.addEventListener("sourceended",this.onmse);n.addEventListener("sourceclose",this.onmsc);r.renderingBufferHint="none";r.src=URL.createObjectURL(n)}}},{key:"onMediaDetaching",value:function e(){}},{key:"onH264DataAppending",value:function e(t){if(!this.config.recording||!t.data)return;var r=this;r.h264Frames.push(t);r.mediaSize+=t.data.length;if(r.mediaSize>=r.rec_threshold_single){if(r.rec_state_cb){r.rec_state_cb(false)}r.onRecordingStop();r.onRecordingStart();if(r.rec_state_cb){r.rec_state_cb(true)}}if(!this.mp4Encoder&&this.config.mode=="video"){this.createMp4Encoder()}this.encodeToMp4File()}},{key:"onAACDataAppending",value:function e(t){if(!this.config.recording||!t.data)return;var r=this;r.aacFrames.push(t);r.mediaSize+=t.data.length;if(!this.mp4Encoder){this.createMp4Encoder()}if(r.mediaSize>=r.rec_threshold_single){if(r.rec_state_cb){r.rec_state_cb(false)}r.onRecordingStop();r.onRecordingStart();if(r.rec_state_cb){r.rec_state_cb(true)}}this.encodeToMp4File()}},{key:"createMp4Encoder",value:function e(){var t=this.config.fps;if(t===0){t=30}var r=this.mediaType==="H265Raw";var n=this.track_info.width;var i=this.track_info.height;var a=0;var o=null;if(this.aacFrames.length>0){this.aac_track=l.default.parseAACConfig(this.aacFrames[0].data,this.wfs.audioInfo.sampleRate);a=this.aac_track.channelCount;this.aac_track.sampleRate=this.wfs.audioInfo.sampleRate;o=this.aac_track.config;this.aac_track.duration=1024/this.aac_track.sampleRate*this.config.timescale}this.mp4Encoder=A.createEncoder({width:n,height:i,fps:t,hevc:r,audio_channel_count:a},o)}},{key:"encodeToMp4File",value:function e(){if(!this.mp4Encoder){return}var t=this.config.timescale;{var r=this.last_pts.video;while(this.h264Frames.length){var n=this.h264Frames.shift();var i=(n.pts-r)*t/1e3;if(r==0){i=500}this.mp4Encoder.addNalu(n.data,i);r=n.pts}this.last_pts.video=r}{var a=this.last_pts.audio;while(this.aacFrames.length){var o=this.aacFrames.shift();var s=(o.pts-a)*t/1e3;if(a==0){s=500}var u=this.aac_track.headerLength;var f=o.data;var c=l.default.getFrameLength(f);this.mp4Encoder.addAAC(f.subarray(u,c),s);a=o.pts}this.last_pts.audio=a}}},{key:"saveToMP4Blob",value:function e(){var t=new Blob([this.mp4Encoder.end()]);this.writeMP4Data(t);this.mp4Encoder=null}},{key:"writeMP4Data",value:function e(t){var r=this;r._fs.root.getFile("ax_video/"+r.rec_file,{create:true},function(e){e.createWriter(function(e){e.onwriteend=function(e){};e.onerror=function(e){console.log("Write rec data failed: "+e.toString())};e.seek(e.length);e.write(t)},r.errorHandler)},r.errorHandler)}},{key:"onBufferAppending",value:function e(t){if(t.type=="audio"){this.audioBuffer.appendBuffer(t);return}this.segments.push(t);this.doAppending()}},{key:"onMediaSourceClose",value:function e(){console.log("media source closed")}},{key:"onMediaSourceEnded",value:function e(){console.log("media source ended")}},{key:"onSBUpdateEnd",value:function e(t){this.appending=false;this.doAppending();if(this.needSeek){this.doPlay();this.needSeek=false}else{this._chaseLiveLatency()}}},{key:"onMediaSourceOpen",value:function e(){console.log("media source open");this.wfs.trigger(u.default.MEDIA_ATTACHED,{media:this.media,mediaType:this.mediaType,websocketName:this.websocketName})}},{key:"onBufferReset",value:function e(t){this.createSourceBuffers({type:t.type,mimeType:t.mimeType});this.track_info.width=t.width;this.track_info.height=t.height}},{key:"createSourceBuffers",value:function e(t){var r=this.sourceBuffers;var n=this.mediaSource;var i="video/mp4;codecs="+t.mimeType;try{var a=r[t.type]=n.addSourceBuffer(i);a.addEventListener("updateend",this.onsbue);if(this.config.mode==="both"&&this.wfs.audioReady){i='audio/mp4; codecs="'+this.config.audioCodecs+'"';var o=n.addSourceBuffer(i);this.audioBuffer=new f.default(o);this.config.videoReady=true;this.wfs.trigger(u.default.AUDIO_DATA_REMUXER,null)}}catch(e){console.log("AddSourceBuffer failed, errcode: "+e.code+" err message: "+e.message)}this.doPlay()}},{key:"onPlayerSeekNow",value:function e(){if(this.mediaElement&&this.mediaElement.buffered&&this.mediaElement.buffered.length>0){var t=this.mediaElement.buffered.end(0);this.mediaElement.currentTime=t}}},{key:"doAppending",value:function e(){var t=this.wfs,r=this.sourceBuffers,n=this.segments;if(Object.keys(r).length){if(this.mediaElement.error){this.segments=[];this.mediaErrorCount++;if(this.mediaErrorCount<100){console.log("doAppending although a media error occured, error code:",this.mediaElement.error.code,"message:",this.mediaElement.error.message)}else{var i={type:s.ErrorTypes.MEDIA_ERROR};i.details=s.ErrorDetails.BUFFER_APPEND_ERROR;i.frag=this.fragCurrent;i.fatal=true;this.wfs.trigger(u.default.ERROR,i)}return}this.mediaErrorCount=0;if(this.appending){return}if(n&&n.length){var a=n.shift();try{if(r[a.type]){r[a.type].appendBuffer(a.data);this.appendError=0;this.appended++;this.appending=true;a.data=null}}catch(e){n.unshift(a);console.log("errcode: "+e.code+" err message: "+e.message);var o={type:s.ErrorTypes.MEDIA_ERROR};if(e.code!==22){this.appendError++;o.details=s.ErrorDetails.BUFFER_APPEND_ERROR;o.frag=this.fragCurrent;if(this.appendError>t.config.appendErrorMaxRetry){n=[];o.fatal=true}else{o.fatal=false}}else{this.segments=[];o.details=s.ErrorDetails.BUFFER_FULL_ERROR;o.fatal=true}this.wfs.trigger(u.default.ERROR,o)}}}}},{key:"doPlay",value:function e(){if(this.mediaElement){var t=this.mediaElement.play();if(t!==undefined){t.then(function(e){}).catch(function(e){console.log("play failed, errcode: "+e.code+" err message: "+e.message)})}}}},{key:"_chaseLiveLatency",value:function e(){var t=this.mediaElement.buffered;if(t.length==0){return}var r=this.mediaElement.currentTime;var n=this.wfs.config.liveMaxLatency;var i=t.end(t.length-1);if(i>n&&i-r>n){this.onPlayerSeekNow()}}}]);return r}(n.default);var P=r.default=R},{"../audio/aac-parser":3,"../audio/audio-buffer":5,"../errors":12,"../event-handler":13,"../events":14,"../utils/mp4-encoder":27}],9:[function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var o=a(e("../events"));var n=a(e("../event-handler"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,c(n.key),n)}}function f(e,t,r){if(t)u(e.prototype,t);if(r)u(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function c(e){var t=l(e,"string");return"symbol"==i(t)?t:String(t)}function l(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function d(e,t,r){return t=y(t),h(e,v()?Reflect.construct(t,r||[],y(e).constructor):t.apply(e,r))}function h(e,t){if(t&&(i(t)==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return p(e)}function p(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function v(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(v=function e(){return!!t})()}function y(e){y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return y(e)}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)b(e,t)}function b(e,t){b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return b(e,t)}var g=function(e){m(t,e);function t(e){s(this,t);return d(this,t,[e,o.default.MEDIA_ATTACHED,o.default.WEBSOCKET_ATTACHED,o.default.FRAG_PARSING_DATA,o.default.FRAG_PARSING_INIT_SEGMENT])}f(t,[{key:"destroy",value:function e(){n.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function e(t){console.log("media attached");if(t.websocketName!=undefined){var r="ws://"+window.location.host+"/"+t.websocketName;var n="binary";console.log("websocket: ",r);var i=new WebSocket(r,n);var a={};if(this.wfs.config.mode==="both"&&this.wfs.audioInfo){var o="ws://"+window.location.host+"/"+this.wfs.audioInfo.websocketName;a.websocket=new WebSocket(o,n);a.mediaType=this.wfs.audioInfo.mediaType}else{this.wfs.config.mode="video";a=undefined}this.wfs.attachWebsocket(i,a)}else{console.log("websocketName ERROE!!!")}}},{key:"onFragParsingInitSegment",value:function e(t){var r=t.tracks,n;for(n in r){var i=r[n];var a=i.initSegment;if(a){this.wfs.trigger(o.default.BUFFER_APPENDING,{type:n,data:a})}}}},{key:"onFragParsingData",value:function e(t){var r=this;[t.data1,t.data2].forEach(function(e){if(e){r.wfs.trigger(o.default.BUFFER_APPENDING,{type:t.type,data:e})}})}}]);return t}(n.default);var _=r.default=g},{"../event-handler":13,"../events":14}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var i=e("../utils/logger");function a(e){"@babel/helpers - typeof";return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,u(n.key),n)}}function s(e,t,r){if(t)o(e.prototype,t);if(r)o(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function u(e){var t=f(e,"string");return"symbol"==a(t)?t:String(t)}function f(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var c=function(){function t(e){n(this,t);this.data=e;this.bytesAvailable=this.data.byteLength;this.word=0;this.bitsAvailable=0}s(t,[{key:"loadWord",value:function e(){var t=this.data.byteLength-this.bytesAvailable,r=new Uint8Array(4),n=Math.min(4,this.bytesAvailable);if(n===0){throw new Error("no bytes available")}r.set(this.data.subarray(t,t+n));this.word=new DataView(r.buffer).getUint32(0);this.bitsAvailable=n*8;this.bytesAvailable-=n}},{key:"skipBits",value:function e(t){var r;if(this.bitsAvailable>t){this.word<<=t;this.bitsAvailable-=t}else{t-=this.bitsAvailable;r=t>>3;t-=r>>3;this.bytesAvailable-=r;this.loadWord();this.word<<=t;this.bitsAvailable-=t}}},{key:"readBits",value:function e(t){var r=Math.min(this.bitsAvailable,t),n=this.word>>>32-r;if(t>32){i.logger.error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=r;if(this.bitsAvailable>0){this.word<<=r}else if(this.bytesAvailable>0){this.loadWord()}r=t-r;if(r>0){return n<<r|this.readBits(r)}else{return n}}},{key:"skipLZ",value:function e(){var t;for(t=0;t<this.bitsAvailable;++t){if(0!==(this.word&2147483648>>>t)){this.word<<=t;this.bitsAvailable-=t;return t}}this.loadWord();return t+this.skipLZ()}},{key:"skipUEG",value:function e(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function e(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function e(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function e(){var t=this.readUEG();if(1&t){return 1+t>>>1}else{return-1*(t>>>1)}}},{key:"readBoolean",value:function e(){return 1===this.readBits(1)}},{key:"readUByte",value:function e(){return this.readBits(8)}},{key:"readUShort",value:function e(){return this.readBits(16)}},{key:"readUInt",value:function e(){return this.readBits(32)}},{key:"skipScalingList",value:function e(t){var r=8,n=8,i,a;for(i=0;i<t;i++){if(n!==0){a=this.readEG();n=(r+a+256)%256}r=n===0?r:n}}},{key:"readSPS",value:function e(){var t=0,r=0,n=0,i=0,a=1,o,s,u,f,c,l,d,h,p;this.readUByte();o=this.readUByte();s=this.readBits(5);this.skipBits(3);u=this.readUByte();this.skipUEG();if(o===100||o===110||o===122||o===244||o===44||o===83||o===86||o===118||o===128){var v=this.readUEG();if(v===3){this.skipBits(1)}this.skipUEG();this.skipUEG();this.skipBits(1);if(this.readBoolean()){h=v!==3?8:12;for(p=0;p<h;p++){if(this.readBoolean()){if(p<6){this.skipScalingList(16)}else{this.skipScalingList(64)}}}}}this.skipUEG();var y=this.readUEG();if(y===0){this.readUEG()}else if(y===1){this.skipBits(1);this.skipEG();this.skipEG();f=this.readUEG();for(p=0;p<f;p++){this.skipEG()}}this.skipUEG();this.skipBits(1);c=this.readUEG();l=this.readUEG();d=this.readBits(1);if(d===0){this.skipBits(1)}this.skipBits(1);if(this.readBoolean()){t=this.readUEG();r=this.readUEG();n=this.readUEG();i=this.readUEG()}if(this.readBoolean()){if(this.readBoolean()){var m;var b=this.readUByte();switch(b){case 1:m=[1,1];break;case 2:m=[12,11];break;case 3:m=[10,11];break;case 4:m=[16,11];break;case 5:m=[40,33];break;case 6:m=[24,11];break;case 7:m=[20,11];break;case 8:m=[32,11];break;case 9:m=[80,33];break;case 10:m=[18,11];break;case 11:m=[15,11];break;case 12:m=[64,33];break;case 13:m=[160,99];break;case 14:m=[4,3];break;case 15:m=[3,2];break;case 16:m=[2,1];break;case 255:{m=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()];break}}if(m){a=m[0]/m[1]}}}return{width:Math.ceil(((c+1)*16-t*2-r*2)*a),height:(2-d)*(l+1)*16-(d?2:4)*(n+i)}}},{key:"readSliceType",value:function e(){this.readUByte();this.readUEG();return this.readUEG()}}]);return t}();var l=r.default=c},{"../utils/logger":26}],11:[function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var m=n(e("../events"));var b=n(e("./exp-golomb"));var a=n(e("../event-handler"));var o=n(e("../remux/mp4-remuxer"));function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,c(n.key),n)}}function f(e,t,r){if(t)u(e.prototype,t);if(r)u(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function c(e){var t=l(e,"string");return"symbol"==i(t)?t:String(t)}function l(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function d(e,t,r){return t=y(t),h(e,v()?Reflect.construct(t,r||[],y(e).constructor):t.apply(e,r))}function h(e,t){if(t&&(i(t)==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return p(e)}function p(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function v(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(v=function e(){return!!t})()}function y(e){y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return y(e)}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)_(e,t)}function _(e,t){_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return _(e,t)}var w=function(e){g(n,e);function n(e){var t;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;s(this,n);t=d(this,n,[e,m.default.H264_DATA_PARSING]);t.config=t.wfs.config||r;t.wfs=e;t.id="main";t.remuxer=new o.default(t.wfs,t.id,t.config);t.contiguous=true;t.timeOffset=1;t.sn=0;t.timestamp=0;t.H264_TIMEBASE=t.config.mp4Duration;t._avcTrack={container:"video/mp4",type:"video",id:1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0,count:0};t.browserType=0;return t}f(n,[{key:"destroy",value:function e(){a.default.prototype.destroy.call(this)}},{key:"getTimestampM",value:function e(){this.timestamp+=this.H264_TIMEBASE;return this.timestamp}},{key:"onH264DataParsing",value:function e(t){var r=this.getTimestampM();if(this.config.mode==="both"){r=t.pts}this._parseAVCTrack(t.data,r);this.remuxer.pushVideo(0,this.sn,this._avcTrack,this.timeOffset,this.contiguous);this.sn+=1;t.data=null}},{key:"_parseAVCTrack",value:function e(t,r){var a=this;var o=this._avcTrack,n=o.samples,i=this._parseAVCNALu(t),s=[],u=false,f=false,c=0,l,d,h,p;var v="";var y=function(){if(s.length){if(!this.config.forceKeyFrameOnDiscontinuity||f===true||o.sps&&(n.length||this.contiguous)){var e=r;d={units:{units:s,length:c},pts:e,dts:e,key:f};n.push(d);o.len+=c;o.nbNalu+=s.length}else{o.dropped++}s=[];c=0}}.bind(this);i.forEach(function(e){switch(e.type){case 1:h=true;if(u){v+="NDR "}break;case 5:h=true;if(u){v+="IDR "}f=true;break;case 6:e.data=a.discardEPB(e.data);l=new b.default(e.data);l.readUByte();break;case 7:h=false;if(u){v+="SPS "}if(!o.sps){l=new b.default(e.data);var t=l.readSPS();o.width=t.width;o.height=t.height;o.sps=[e.data];o.duration=0;var r=e.data.subarray(1,4);var n="avc1.";for(p=0;p<3;p++){var i=r[p].toString(16);if(i.length<2){i="0"+i}n+=i}o.codec=n;a.wfs.trigger(m.default.BUFFER_RESET,{type:"video",mimeType:o.codec,width:o.width,height:o.height});h=true}break;case 8:h=false;if(u){v+="PPS "}if(!o.pps){o.pps=[e.data];h=true}break;case 9:h=false;if(u){v+="AUD "}y();break;default:h=false;v+="unknown NAL "+e.type+" ";break}if(h){s.push(e);c+=e.data.byteLength}});if(u&&v.length){console.log(v)}y()}},{key:"_parseAVCNALu",value:function e(t){var r=0,n=t.byteLength,i,a,o=0;var s=[],u,f,c,l;while(r<n){i=t[r++];switch(o){case 0:if(i===0){o=1}break;case 1:if(i===0){o=2}else{o=0}break;case 2:case 3:if(i===0){o=3}else if(i===1&&r<n){f=t[r]&31;if(c){u={data:t.subarray(c,r-o-1),type:l};s.push(u)}else{}c=r;l=f;o=0}else{o=0}break;default:break}}if(c){u={data:t.subarray(c,n),type:l,state:o};s.push(u)}return s}},{key:"discardEPB",value:function e(t){var r=t.byteLength,n=[],i=1,a,o;while(i<r-2){if(t[i]===0&&t[i+1]===0&&t[i+2]===3){n.push(i+2);i+=2}else{i++}}if(n.length===0){return t}a=r-n.length;o=new Uint8Array(a);var s=0;for(i=0;i<a;s++,i++){if(s===n[0]){s++;n.shift()}o[i]=t[s]}return o}}]);return n}(a.default);var E=r.default=w},{"../event-handler":13,"../events":14,"../remux/mp4-remuxer":24,"./exp-golomb":10}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.ErrorTypes=r.ErrorDetails=void 0;var n=r.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"};var i=r.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException",NETWORK_RECV_DATA_TIMEOUT:"networkRecvDataTimeout"}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var n=i(e("./events"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){"@babel/helpers - typeof";return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,f(n.key),n)}}function u(e,t,r){if(t)s(e.prototype,t);if(r)s(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function f(e){var t=c(e,"string");return"symbol"==a(t)?t:String(t)}function c(e,t){if("object"!=a(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var l=function(){function i(e){o(this,i);this.wfs=e;this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++){r[n-1]=arguments[n]}this.handledEvents=r;this.useGenericHandler=true;this.registerListeners()}u(i,[{key:"destroy",value:function e(){this.unregisterListeners()}},{key:"isEventHandler",value:function e(){return a(this.handledEvents)==="object"&&this.handledEvents.length&&typeof this.onEvent==="function"}},{key:"registerListeners",value:function e(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){if(e==="wfsEventGeneric"){}this.wfs.on(e,this.onEvent)}.bind(this))}}},{key:"unregisterListeners",value:function e(){if(this.isEventHandler()){this.handledEvents.forEach(function(e){this.wfs.off(e,this.onEvent)}.bind(this))}}},{key:"onEvent",value:function e(t,r){this.onEventGeneric(t,r)}},{key:"onEventGeneric",value:function e(t,r){var n=function e(t,r){var n="on"+t.replace("wfs","");if(typeof this[n]!=="function"){}return this[n].bind(this,r)};try{n.call(this,t,r).call()}catch(e){console.log("internal error happened while processing ".concat(t,":").concat(e.message))}}}]);return i}();var d=r.default=l},{"./events":14}],14:[function(e,t,r){"use strict";t.exports={MEDIA_ATTACHING:"wfsMediaAttaching",MEDIA_ATTACHED:"wfsMediaAttached",FRAG_LOADING:"wfsFragLoading",BUFFER_CREATED:"wfsBufferCreated",BUFFER_APPENDING:"wfsBufferAppending",BUFFER_RESET:"wfsBufferReset",BUFFER_CLEAR:"wfsBufferClear",FRAG_PARSING_DATA:"wfsFragParsingData",FRAG_PARSING_INIT_SEGMENT:"wfsFragParsingInitSegment",H264_DATA_APPENDING:"wfsH264DataAppending",AAC_DATA_APPENDING:"wfsAACDataAppending",H264_DATA_PARSING:"wfsH264DataParsing",AUDIO_DATA_PARSING:"wfsAudioDataParsing",AUDIO_DATA_REMUXER:"wfsAudioDataRemuxer",H265_DATA_APPENDING:"wfsH265DataAppending",H265_DATA_PARSING:"wfsH265DataParsing",WEBSOCKET_ATTACHED:"wfsWebsocketAttached",WEBSOCKET_ATTACHING:"wfsWebsocketAttaching",WEBSOCKET_DATA_UPLOADING:"wfsWebsocketDataUploading",FILE_HEAD_LOADING:"wfsFileHeadLoading",FILE_HEAD_LOADED:"wfsFileHeadLoaded",FILE_DATA_LOADING:"wfsFileDataLoading",FILE_DATA_LOADED:"wfsFileDataLoaded",FILE_PARSING_DATA:"wfsFileParsingData",RECORDING_START:"wfsRecordingStart",PLAYER_SEEK_NOW:"wfsPlayerSeekNow",RECORDING_STOP:"wfsRecordingStop",IMAGE_PLAYER_RENDER_END:"wfsImagePlayerRenderEnd",IMAGE_PLAYER_WAIT:"wfsImagePlayerWait",IMAGE_PLAYER_READY:"wfsImagePlayerReady",IMAGE_PLAYER_END:"wfsImagePlayerEnd",IMAGE_PLAYER_BUFFER_UPDATE:"wfsImagePlayerBufferUpdate",PLAYER_PLAY:"wfsPlayerPlay",PLAYER_RESET:"wfsPlayerReset",PLAYER_LOADED_META_DATA:"wfsPlayerRoadedMetaData",ERROR:"wfsError"}},{}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,s(n.key),n)}}function o(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function s(e){var t=u(e,"string");return"symbol"==i(t)?t:String(t)}function u(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var f=function(){function t(e){n(this,t);this._buffer=e;this._buffer_index=0;this._total_bytes=e.byteLength;this._current_word=0;this._current_word_bits_left=0}o(t,[{key:"destroy",value:function e(){this._buffer=null}},{key:"_fillCurrentWord",value:function e(){var t=this._total_bytes-this._buffer_index;if(t<=0)return;var r=Math.min(4,t);var n=new Uint8Array(4);n.set(this._buffer.subarray(this._buffer_index,this._buffer_index+r));this._current_word=new DataView(n.buffer).getUint32(0,false);this._buffer_index+=r;this._current_word_bits_left=r*8}},{key:"readBits",value:function e(t){if(t>32)return null;if(t<=this._current_word_bits_left){var r=this._current_word>>>32-t;this._current_word<<=t;this._current_word_bits_left-=t;return r}var n=this._current_word_bits_left?this._current_word:0;n=n>>>32-this._current_word_bits_left;var i=t-this._current_word_bits_left;this._fillCurrentWord();var a=Math.min(i,this._current_word_bits_left);var o=this._current_word>>>32-a;this._current_word<<=a;this._current_word_bits_left-=a;n=n<<a|o;return n}},{key:"readBool",value:function e(){return this.readBits(1)===1}},{key:"readByte",value:function e(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function e(){var t;for(t=0;t<this._current_word_bits_left;t++){if(0!==(this._current_word&2147483648>>>t)){this._current_word<<=t;this._current_word_bits_left-=t;return t}}this._fillCurrentWord();return t+this._skipLeadingZero()}},{key:"readUEG",value:function e(){var t=this._skipLeadingZero();return this.readBits(t+1)-1}},{key:"readSEG",value:function e(){var t=this.readUEG();if(t&1){return t+1>>>1}else{return-1*(t>>>1)}}}]);return t}();var c=r.default=f},{}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,s(n.key),n)}}function o(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function s(e){var t=u(e,"string");return"symbol"==i(t)?t:String(t)}function u(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var f=function(){function d(){n(this,d)}o(d,null,[{key:"init",value:function e(){d.types={hvc1:[],hvcC:[],avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],pasp:[],".mp3":[]};for(var t in d.types){if(d.types.hasOwnProperty(t)){d.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]}}var r=d.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]);r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]);r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]);r.STSC=r.STCO=r.STTS;r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function e(t){var r=8;var n=null;var i=Array.prototype.slice.call(arguments,1);var a=i.length;for(var o=0;o<a;o++){r+=i[o].byteLength}n=new Uint8Array(r);n[0]=r>>>24&255;n[1]=r>>>16&255;n[2]=r>>>8&255;n[3]=r&255;n.set(t,4);var s=8;for(var o=0;o<a;o++){n.set(i[o],s);s+=i[o].byteLength}return n}},{key:"moov",value:function e(t){var r=d.mvhd(t.timescale,t.duration);var n=d.trak(t);var i=d.mvex(t);return d.box(d.types.moov,r,n,i)}},{key:"mvhd",value:function e(t,r){return d.box(d.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,t&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function e(t){return d.box(d.types.trak,d.tkhd(t),d.mdia(t))}},{key:"tkhd",value:function e(t){var r=t.id,n=t.duration;var i=t.presentWidth,a=t.presentHeight;return d.box(d.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,n&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>>8&255,i&255,0,0,a>>>8&255,a&255,0,0]))}},{key:"mdia",value:function e(t){return d.box(d.types.mdia,d.mdhd(t),d.hdlr(t),d.minf(t))}},{key:"mdhd",value:function e(t){var r=t.timescale;var n=t.duration;return d.box(d.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,85,196,0,0]))}},{key:"hdlr",value:function e(t){var r=null;if(t.type==="audio"){r=d.constants.HDLR_AUDIO}else{r=d.constants.HDLR_VIDEO}return d.box(d.types.hdlr,r)}},{key:"minf",value:function e(t){var r=null;if(t.type==="audio"){r=d.box(d.types.smhd,d.constants.SMHD)}else{r=d.box(d.types.vmhd,d.constants.VMHD)}return d.box(d.types.minf,r,d.dinf(),d.stbl(t))}},{key:"dinf",value:function e(){var t=d.box(d.types.dinf,d.box(d.types.dref,d.constants.DREF));return t}},{key:"stbl",value:function e(t){var r=d.box(d.types.stbl,d.stsd(t),d.box(d.types.stts,d.constants.STTS),d.box(d.types.stsc,d.constants.STSC),d.box(d.types.stsz,d.constants.STSZ),d.box(d.types.stco,d.constants.STCO));return r}},{key:"stsd",value:function e(t){if(t.type==="audio"){if(t.codec==="mp3"){return d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp3(t))}return d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp4a(t))}else{return d.box(d.types.stsd,d.constants.STSD_PREFIX,d.avc1(t))}}},{key:"mp3",value:function e(t){var r=t.channelCount;var n=t.audioSampleRate;var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>>8&255,n&255,0,0]);return d.box(d.types[".mp3"],i)}},{key:"mp4a",value:function e(t){var r=t.channelCount;var n=t.audioSampleRate;var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>>8&255,n&255,0,0]);return d.box(d.types.mp4a,i,d.esds(t))}},{key:"esds",value:function e(t){var r=t.config||[];var n=r.length;var i=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(r).concat([6,1,2]));return d.box(d.types.esds,i)}},{key:"avc1",value:function e(t){var r=t.avcc;var n=t.codecWidth,i=t.codecHeight;var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,n&255,i>>>8&255,i&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);if(t.codec.indexOf("avc1")>=0){return d.box(d.types.avc1,a,d.box(d.types.avcC,r))}else{return d.box(d.types.hvc1,a,d.box(d.types.hvcC,r))}}},{key:"mvex",value:function e(t){return d.box(d.types.mvex,d.trex(t))}},{key:"trex",value:function e(t){var r=t.id;var n=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return d.box(d.types.trex,n)}},{key:"moof",value:function e(t,r){return d.box(d.types.moof,d.mfhd(t.sequenceNumber),d.traf(t,r))}},{key:"mfhd",value:function e(t){var r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,t&255]);return d.box(d.types.mfhd,r)}},{key:"traf",value:function e(t,r){var n=t.id;var i=d.box(d.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,n&255]));var a=d.box(d.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255]));var o=d.sdtp(t);var s=d.trun(t,o.byteLength+16+16+8+16+8+8);return d.box(d.types.traf,i,a,s,o)}},{key:"sdtp",value:function e(t){var r=t.samples||[];var n=r.length;var i=new Uint8Array(4+n);for(var a=0;a<n;a++){var o=r[a].flags;i[a+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return d.box(d.types.sdtp,i)}},{key:"trun",value:function e(t,r){var n=t.samples||[];var i=n.length;var a=12+16*i;var o=new Uint8Array(a);r+=8+a;o.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0);for(var s=0;s<i;s++){var u=n[s].duration;var f=n[s].size;var c=n[s].flags;var l=n[s].cts;o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,l>>>24&255,l>>>16&255,l>>>8&255,l&255],12+16*s)}return d.box(d.types.trun,o)}},{key:"mdat",value:function e(t){return d.box(d.types.mdat,t)}},{key:"initSegment",value:function e(t){if(!d.types){d.init()}var r=d.box(d.types.ftyp,d.constants.FTYP);var n=d.moov(t);var i=new Uint8Array(r.byteLength+n.byteLength);i.set(r,0);i.set(n,r.byteLength);return i}}]);return d}();var c=r.default=f},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var h=n(e("../events"));var i=n(e("../event-handler"));var p=n(e("./hevc-spsparser"));var a=n(e("./h265-remuxer"));function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r){return t=c(t),s(e,f()?Reflect.construct(t,r||[],c(e).constructor):t.apply(e,r))}function s(e,t){if(t&&(v(t)==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return u(e)}function u(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function f(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(f=function e(){return!!t})()}function c(e){c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return c(e)}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)d(e,t)}function d(e,t){d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return d(e,t)}function v(e){"@babel/helpers - typeof";return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,g(n.key),n)}}function b(e,t,r){if(t)m(e.prototype,t);if(r)m(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function g(e){var t=_(e,"string");return"symbol"==v(t)?t:String(t)}function _(e,t){if("object"!=v(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var w=function(){function t(e){y(this,t);this._buffer=e;this._buffer_index=0}b(t,[{key:"destroy",value:function e(){this._buffer=null}},{key:"w8",value:function e(t){this._buffer[this._buffer_index++]=t}},{key:"wb16",value:function e(t){this.w8(t>>8&255);this.w8(t&255)}},{key:"wb32",value:function e(t){this.w8(t>>24&255);this.w8(t>>16&255);this.w8(t>>8&255);this.w8(t&255)}}]);return t}();var E=function(e){l(n,e);function n(e){var t;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;y(this,n);t=o(this,n,[e,h.default.H265_DATA_PARSING]);t.config=t.wfs.config||r;t.wfs=e;t.id="main";t.remuxer=new a.default(t.wfs,t.id,t.config);t.sn=0;t.timestamp=0;t.H265_TIMEBASE=t.config.mp4Duration;t._avcTrack={container:"video/mp4",type:"video",id:1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0,count:0,meta:{}};t.browserType=0;if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1){t.browserType=1}t.avccReady=false;return t}b(n,[{key:"destroy",value:function e(){i.default.prototype.destroy.call(this)}},{key:"getTimestampM",value:function e(){this.timestamp+=this.H265_TIMEBASE;return this.timestamp}},{key:"onH265DataParsing",value:function e(t){this._parseAVCTrack(t.data,t.pts);var r=this._avcTrack;if(!this.avccReady&&r.sps){var n=r.meta;var i=32;var a=33;var o=34;var s=this.packet_nalu(i,r.vps[0]);var u=this.packet_nalu(a,r.sps[0]);var f=this.packet_nalu(o,r.pps[0]);var c=new Uint8Array(n.avcc.byteLength+s.byteLength+u.byteLength+f.byteLength);var l=0;c.set(n.avcc,l);l=n.avcc.byteLength;c.set(s,l);l+=s.byteLength;c.set(u,l);l+=u.byteLength;c.set(f,l);n.avcc=c;this.avccReady=true}this.remuxer.pushVideo(this.sn,this._avcTrack)}},{key:"packet_nalu",value:function e(t,r){var n=new Uint8Array(5);var i=new w(n);var a=0;var o=t;var s=1;i.w8(a<<7|o&63);i.wb16(s);i.wb16(r.byteLength);var u=new Uint8Array(r.byteLength+n.byteLength);u.set(n);u.set(r,n.byteLength);return u}},{key:"_parseAVCTrack",value:function e(t,r){var a=this;var o=this._avcTrack,n=o.samples,i=this._parseAVCNALu(t),s=[],u=false,f=0,c,l=false;var d=function(){if(s.length){if(!this.config.forceKeyFrameOnDiscontinuity||u===true||o.sps){var e=this.getTimestampM();if(this.config.mode==="both"){e=r}c={units:{units:s,length:f},pts:e,dts:e,key:u};n.push(c);o.len+=f;o.nbNalu+=s.length}s=[];f=0}}.bind(this);i.forEach(function(e){switch(e.type){case 1:l=true;break;case 32:if(!o.vps){o.vps=[e.data]}break;case 33:l=false;if(!o.sps){var t=new p.default;var r=t.parseSPS(e.data);var n={};n.type="video";n.id=o.id;n.duration=0;n.codecWidth=r.codec_size.width;n.codecHeight=r.codec_size.height;n.presentWidth=r.present_size.width;n.presentHeight=r.present_size.height;n.profile=r.profile_string;n.level=r.level_string;n.profile_idc=r.profile_idc;n.level_idc=r.level_idc;n.bitDepth=r.bit_depth;n.chromaFormat=r.chroma_format;n.sarRatio=r.sar_ratio;n.frameRate=r.frame_rate;var i="hvc1."+n.profile_idc+"."+"1"+".L"+n.level_idc+".B0";n.codec=i;n.avcc=a._generalAvccData(r.avcc);o.width=r.codec_size.width;o.height=r.codec_size.height;o.sps=[e.data];o.duration=n.duration;o.codec=i;o.meta=n;a.wfs.trigger(h.default.BUFFER_RESET,{type:"video",mimeType:o.codec,width:o.width,height:o.height});l=true}break;case 34:l=false;if(!o.pps){o.pps=[e.data]}break;default:{if(e.data&&e.type>=16&&e.type<=23){l=true;u=true}break}}if(l&&o.sps){s.push(e);f+=e.data.byteLength}});d()}},{key:"_parseAVCNALu",value:function e(t){var r=0,n=t.byteLength,i,a=0;var o=[],s,u,f,c;while(r<n){i=t[r++];switch(a){case 0:if(i===0){a=1}break;case 1:if(i===0){a=2}else{a=0}break;case 2:case 3:if(i===0){a=3}else if(i===1&&r<n){u=(t[r]&126)>>>1;if(f){s={data:t.subarray(f,r-a-1),type:c};o.push(s)}else{}f=r;c=u;a=0}else{a=0}break;default:break}}if(f){s={data:t.subarray(f,n),type:c,state:a};o.push(s)}return o}},{key:"_generalAvccData",value:function e(t){var r=new Uint8Array(23);var n=new w(r);n.w8(t.configurationVersion);n.w8(t.profile_space<<6|t.tier_flag<<5|t.profile_idc);n.wb32(t.profile_compatibility_flags);n.wb32(t.constraint_indicator_flags>>16);n.wb16(t.constraint_indicator_flags);n.w8(t.level_idc);n.wb16(t.min_spatial_segmentation_idc|61440);n.w8(t.parallelismType|252);n.w8(t.chromaFormat|252);n.w8(t.bitDepthLumaMinus8|248);n.w8(t.bitDepthChromaMinus8|248);n.wb16(t.avgFrameRate);n.w8(t.constantFrameRate<<6|t.numTemporalLayers<<3|t.temporalIdNested<<2|t.lengthSizeMinusOne);n.w8(t.numOfArrays);return r}}]);return n}(i.default);var S=r.default=E},{"../event-handler":13,"../events":14,"./h265-remuxer":18,"./hevc-spsparser":19}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var A=n(e("../events"));var T=n(e("./fmp4-generator"));e("../utils/polyfill");function n(e){return e&&e.__esModule?e:{default:e}}function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,u(n.key),n)}}function s(e,t,r){if(t)o(e.prototype,t);if(r)o(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function u(e){var t=f(e,"string");return"symbol"==i(t)?t:String(t)}function f(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var c=function(){function n(e,t,r){a(this,n);this.observer=e;this.id=t;this.config=r;this.ISGenerated=false;this.PES_TIMESCALE=this.config.timescale;this.nextAvcDts=this.PES_TIMESCALE+300;this.H264_TIMEBASE=this.config.mp4Duration;this.lastDTS=0;this.baseDecodeTime=0}s(n,[{key:"passthrough",get:function e(){return false}},{key:"destroy",value:function e(){}},{key:"insertDiscontinuity",value:function e(){this._initPTS=this._initDTS=undefined}},{key:"pushVideo",value:function e(t,r){this.sn=t;if(!this.ISGenerated){this.generateVideoIS(r)}if(!this.ISGenerated){return}if(this.config.mode==="both"){this.remuxVideoWithAudio(r)}else{this.remuxVideo(r)}}},{key:"remuxVideoWithAudio",value:function e(t){var r=8,n,i,a=t.samples,o=[];n=new Uint8Array(t.len+4*t.nbNalu+8);var s=new DataView(n.buffer);s.setUint32(0,n.byteLength);n.set(T.default.types.mdat,4);var u=0;for(var f=0;f<a.length;f++){var c=a[f],l=0;while(c.units.units.length){var d=c.units.units.shift();s.setUint32(r,d.data.byteLength);r+=4;n.set(d.data,r);r+=d.data.byteLength;l+=4+d.data.byteLength}var h=(c.dts-this.lastDTS)/1e3*this.PES_TIMESCALE;if(this.lastDTS==0){h=500}u+=h;o.push({size:l,duration:h,cts:0,flags:{isLeading:0,hasRedundancy:0,degradPrio:0,dependsOn:c.key?2:1,isDependedOn:c.key?1:0,isNonSync:c.key?0:1}});this.lastDTS=c.dts}t.len=0;t.samples=o;i=T.default.moof(t,this.baseDecodeTime);t.sequenceNumber++;this.baseDecodeTime+=u;t.samples=[];var p={data1:i,data2:n,type:"video"};this.observer.trigger(A.default.FRAG_PARSING_DATA,p);return p}},{key:"remuxVideo",value:function e(t){var r=8,n,i,a=t.samples,o=[];if(a.length<1){return}n=new Uint8Array(t.len+4*t.nbNalu+8);var s=new DataView(n.buffer);s.setUint32(0,n.byteLength);n.set(T.default.types.mdat,4);var u=0;var f,c,l,d;for(var h=0;h<a.length;h++){var p=a[h],v=0;while(p.units.units.length){var y=p.units.units.shift();s.setUint32(r,y.data.byteLength);r+=4;n.set(y.data,r);r+=y.data.byteLength;v+=4+y.data.byteLength}var m=p.pts-this._initPTS;var b=p.dts-this._initDTS;b=Math.min(m,b);if(d!==undefined){f=this._PTSNormalize(m,d);c=this._PTSNormalize(b,d);u=c-d;if(u<=0){u=1}}else{var g=this.nextAvcDts,_;f=this._PTSNormalize(m,g);c=this._PTSNormalize(b,g);if(g){_=Math.round(c-g);if(Math.abs(_)<600){if(_){c=g;f=Math.max(f-_,c)}}}this.firstPTS=Math.max(0,f);this.firstDTS=Math.max(0,c);u=.03}o.push({size:v,duration:this.H264_TIMEBASE,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:p.key?2:1,isNonSync:p.key?0:1}});d=c}var w=0;if(o.length>=2){w=o[o.length-2].duration;o[0].duration=w}this.nextAvcDts=c+w;t.len=0;t.nbNalu=0;t.dropped=0;if(o.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var E=o[0].flags;E.dependsOn=2;E.isNonSync=0}t.samples=o;i=T.default.moof(t,c);t.sequenceNumber++;t.samples=[];var S={data1:i,data2:n,type:"video"};this.observer.trigger(A.default.FRAG_PARSING_DATA,S);return S}},{key:"generateVideoIS",value:function e(t){var r=this.observer,n=t.samples,i={},a={id:this.id,tracks:i},o=this._initPTS===undefined,s,u;if(o){s=u=Infinity}if(t.sps&&n.length){t.meta.timescale=this.PES_TIMESCALE;i.video={type:"video",container:"video/mp4",initSegment:T.default.initSegment(t.meta),metadata:{width:t.width,height:t.height}};if(o){s=Math.min(s,n[0].pts-this.H264_TIMEBASE);u=Math.min(u,n[0].dts-this.H264_TIMEBASE)}}if(Object.keys(i).length){r.trigger(A.default.FRAG_PARSING_INIT_SEGMENT,a);this.ISGenerated=true;if(o){this._initPTS=s;this._initDTS=u}}}},{key:"_PTSNormalize",value:function e(t,r){var n;if(r===undefined){return t}if(r<t){n=-8589934592}else{n=8589934592}while(Math.abs(t-r)>4294967296){t+=n}return t}}]);return n}();var l=r.default=c},{"../events":14,"../utils/polyfill":28,"./fmp4-generator":16}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var M=n(e("./exp-golomb"));function n(e){return e&&e.__esModule?e:{default:e}}function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,u(n.key),n)}}function s(e,t,r){if(t)o(e.prototype,t);if(r)o(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function u(e){var t=f(e,"string");return"symbol"==i(t)?t:String(t)}function f(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var c=function(){function e(){a(this,e)}s(e,[{key:"_ebsp2rbsp",value:function e(t){var r=t;var n=r.byteLength;var i=new Uint8Array(n);var a=0;for(var o=0;o<n;o++){if(o>=2){if(r[o]===3&&r[o-1]===0&&r[o-2]===0){continue}}i[a]=r[o];a++}return new Uint8Array(i.buffer,0,a)}},{key:"parseSPS",value:function U(e){var t=this._ebsp2rbsp(e);var r=new M.default(t);var n={};var i={};i.configurationVersion=1;i.lengthSizeMinusOne=3;i.numOfArrays=3;r.readBits(16);r.readBits(4);var a=r.readBits(3);i.numTemporalLayers=a+1;i.temporalIdNested=r.readBits(1);this._hvcc_parse_ptl(r,n,i,a);r.readUEG();var o=0;var s=r.readUEG();if(s==3){o=r.readBits(1)}n.sar_width=n.sar_height=1;n.conf_win_left_offset=n.conf_win_right_offset=n.conf_win_top_offset=n.conf_win_bottom_offset=0;n.def_disp_win_left_offset=n.def_disp_win_right_offset=n.def_disp_win_top_offset=n.def_disp_win_bottom_offset=0;var u=r.readUEG();var f=r.readUEG();var c=0,l=0,d=0,h=0;i.parallelismType=1;i.bitDepthLumaMinus8=0;var p=r.readBits(1);if(p){n.conf_win_left_offset=r.readUEG();n.conf_win_right_offset=r.readUEG();n.conf_win_top_offset=r.readUEG();n.conf_win_bottom_offset=r.readUEG();if(n.default_display_window_flag===1){c=n.conf_win_left_offset+n.def_disp_win_left_offset;l=n.conf_win_right_offset+n.def_disp_win_right_offset;d=n.conf_win_top_offset+n.def_disp_win_top_offset;h=n.conf_win_bottom_offset+n.def_disp_win_bottom_offset}}var v=r.readUEG()+8;i.bitDepthLumaMinus8=v-8;i.bitDepthChromaMinus8=r.readUEG();i.min_spatial_segmentation_idc=0;var y=r.readUEG();var m=r.readBits(1)?0:a;for(;m<=a;m++){this._skip_sub_layer_ordering_info(r)}r.readUEG();r.readUEG();r.readUEG();r.readUEG();r.readUEG();r.readUEG();if(r.readBits(1)&&r.readBits(1)){this._skip_scaling_list_data(r)}r.readBits(1);r.readBits(1);if(r.readBits(1)){r.readBits(4);r.readBits(4);r.readUEG();r.readUEG();r.readBits(1)}var b=[];var g=r.readUEG();for(m=0;m<g;m++){var _=this._parse_rps(r,m,g,b);if(_<0)return _}if(r.readBits(1)){var w=r.readUEG();for(m=0;m<w;m++){var E=Math.min(y+4,16);if(E>32){var S=E/32;var A=E%32;for(var T=0;T<S;T++){r.readBits(32)}r.readBits(A)}else{r.readBits(E)}r.readBits(1)}}var k=1;r.readBits(1);r.readBits(1);if(r.readBits(1)){this._hvcc_parse_vui(r,n,i,a)}var R=this.getProfileString(n.profile_idc);var P=this.getLevelString(n.level_idc);var L=1;if(n.sar_width!==1||n.sar_height!==1){L=n.sar_width/n.sar_height}var O=u,x=f;var D=(1===s||2==s)&&0===o?2:1;var C=1===s&&0===o?2:1;O-=D*(n.conf_win_left_offset+n.conf_win_right_offset);x-=C*(n.conf_win_top_offset+n.conf_win_bottom_offset);var I=Math.ceil(O*L);r.destroy();r=null;i.chromaFormat=s;i.avgFrameRate=n.fps;i.constantFrameRate=n.fps;i.numOfArrays=3;i.profile_space=0;return{profile_string:R,level_string:P,profile_idc:n.profile_idc,level_idc:n.level_idc,bit_depth:v,ref_frames:k,chroma_format:s,chroma_format_string:this.getChromaFormatString(s),frame_rate:{fixed:n.fps_fixed,fps:n.fps,fps_den:n.fps_den,fps_num:n.fps_num},sar_ratio:{width:n.sar_width,height:n.sar_height},codec_size:{width:O,height:x},present_size:{width:I,height:x},avcc:i}}},{key:"_hvcc_parse_ptl",value:function e(t,r,n,i){t.readBits(2);var a=t.readBits(1);n.tier_flag=a;var o=t.readBits(5);n.profile_compatibility_flags=t.readBits(32);n.constraint_indicator_flags=t.readBits(32);t.readBits(16);var s=t.readByte();if(r.tier_flag===undefined||r.level_idc===undefined||r.tier_flag<a){r.level_idc=s}else{r.level_idc=Math.max(r.level_idc,s)}n.level_idc=r.level_idc;r.profile_idc=Math.max(r.profile_idc===undefined?0:r.profile_idc,o);n.profile_idc=r.profile_idc;var u=[];var f=[];for(var c=0;c<i;c++){u.push(t.readBits(1));f.push(t.readBits(1))}if(i>0){for(var c=i;c<8;c++){t.readBits(2)}}for(c=0;c<i;c++){if(u[c]){t.readBits(32);t.readBits(32);t.readBits(24)}if(f[c]){t.readByte()}}}},{key:"_parse_rps",value:function e(t,r,n,i){if(r&&t.readBits(1)){if(r>=n)return-1;t.readBits(1);t.readUEG();i[r]=0;for(var a=0;a<=i[r-1];a++){var o=0;var s=t.readBits(1);if(!s){o=t.readBits(1)}if(s||o){i[r]++}}}else{var u=t.readUEG();var f=t.readUEG();i[r]=u+f;for(var a=0;a<u;a++){t.readUEG();t.readBits(1)}for(a=0;a<f;a++){t.readUEG();t.readBits(1)}}return 0}},{key:"_hvcc_parse_vui",value:function e(t,r,n,i){if(t.readBits(1)){if(t.readByte()==255){r.sar_width=t.readBits(16);r.sar_height=t.readBits(16)}}if(t.readBits(1)){t.readBits(1)}if(t.readBits(1)){t.readBits(4);if(t.readBits(1)){t.readBits(24)}}if(t.readBits(1)){t.readUEG();t.readUEG()}t.readBits(3);r.default_display_window_flag=t.readBits(1);if(r.default_display_window_flag){r.def_disp_win_left_offset=t.readUEG();r.def_disp_win_right_offset=t.readUEG();r.def_disp_win_top_offset=t.readUEG();r.def_disp_win_bottom_offset=t.readUEG()}if(t.readBits(1)){this._skip_timing_info(t,r);if(t.readBits(1)){this._skip_hrd_parameters(t,r,1,i)}}if(t.readBits(1)){t.readBits(3);n.min_spatial_segmentation_idc=t.readUEG();t.readUEG();t.readUEG();t.readUEG();t.readUEG()}}},{key:"_skip_sub_layer_ordering_info",value:function e(t,r){t.readUEG();t.readUEG();t.readUEG()}},{key:"_skip_scaling_list_data",value:function e(t){for(var r=0;r<4;r++){for(var n=0;n<(r==3?2:6);n++){if(!t.readBits(1)){t.readUEG()}else{var i=Math.min(64,1<<4+(r<<1));if(r>1){t.readSEG()}for(var a=0;a<i;a++){t.readSEG()}}}}}},{key:"_skip_sub_layer_hrd_parameters",value:function e(t,r,n){for(var i=0;i<=r;i++){t.readUEG();t.readUEG();if(n){t.readUEG();t.readUEG()}t.readBits(1)}}},{key:"_skip_timing_info",value:function e(t,r){r.fps_den=t.readBits(32);r.fps_num=t.readBits(32);if(r.fps_den>0){r.fps=r.fps_num/r.fps_den}var n=0;if(t.readBits(1)){n=t.readUEG();if(n>=0){r.fps/=n+1}}}},{key:"_skip_hrd_parameters",value:function e(t,r,n){var i=0;var a=0;var o=0;if(r){a=t.readBits(1);o=t.readBits(1);if(a||o){var s=t.readBits(1);if(s){t.readBits(19)}t.readByte();if(s){t.readBits(4)}t.readBits(15)}}for(var u=0;u<=n;u++){var f=0;var c=0;var l=0;var d=t.readBits(1);hvcc.fps_fixed=d;if(!d){l=t.readBits(1)}if(l){t.readUEG()}else{c=t.readBits(1)}if(!c){f=t.readUEG(t)}if(a){this._skip_sub_layer_hrd_parameters(t,f,i)}if(o){this._skip_sub_layer_hrd_parameters(t,f,i)}}}},{key:"getProfileString",value:function e(t){switch(t){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}}},{key:"getLevelString",value:function e(t){return(t/30).toFixed(1)}},{key:"getChromaFormatString",value:function e(t){switch(t){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}}}]);return e}();var l=r.default=c},{"./exp-golomb":15}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,s(n.key),n)}}function o(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function s(e){var t=u(e,"string");return"symbol"==i(t)?t:String(t)}function u(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var f=function(){function e(){n(this,e)}o(e,null,[{key:"getSilentFrame",value:function e(t){if(t===1){return new Uint8Array([0,200,0,128,35,128])}else if(t===2){return new Uint8Array([33,0,73,144,2,25,0,35,128])}else if(t===3){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}else if(t===4){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}else if(t===5){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}else if(t===6){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}return null}}]);return e}();var c=r.default=f},{}],21:[function(e,t,r){"use strict";t.exports=e("./wfs.js").default},{"./wfs.js":30}],22:[function(e,t,r){"use strict";function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var a=e("../errors");var f=d(e("../events"));var n=d(e("../event-handler"));var o=d(e("../audio/audio-loader"));var s=d(e("../demux/h264-demuxer"));var u=d(e("../h265/h265-demuxer"));var m=d(e("../utils/webgl-payer"));var c=d(e("../wfs"));var l=d(e("../helper/aac"));function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,y(n.key),n)}}function v(e,t,r){if(t)p(e.prototype,t);if(r)p(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function y(e){var t=b(e,"string");return"symbol"==i(t)?t:String(t)}function b(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function g(e,t,r){return t=S(t),_(e,E()?Reflect.construct(t,r||[],S(e).constructor):t.apply(e,r))}function _(e,t){if(t&&(i(t)==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return w(e)}function w(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function E(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(E=function e(){return!!t})()}function S(e){S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return S(e)}function A(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)T(e,t)}function T(e,t){T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return T(e,t)}var k=function(e){A(r,e);function r(e){var t;h(this,r);t=g(this,r,[e,f.default.WEBSOCKET_ATTACHING,f.default.WEBSOCKET_DATA_UPLOADING]);t.buf=null;t.ctx=null;t.h264Demuxer=new s.default(e);t.websocketName=undefined;t.media=undefined;t.mediaType=undefined;t.mediaCode=0;t.isForceClosed=false;t.timer=undefined;t.lastRecvDataTime=0;t.extraData=undefined;t.isLoaded=false;t.webglPlayer=null;t.canvas=null;t.processor=null;t.h265Demuxer=null;if(c.default.isSupportedHEVC()){t.h265Demuxer=new u.default(e)}t.audioLoader=undefined;return t}v(r,[{key:"create_timer",value:function e(){var n=this;this.lastRecvDataTime=performance.now();this.timer=setInterval(function(){if(n.lastRecvDataTime>0){var e=performance.now();var t=e-n.lastRecvDataTime;if(t>n.wfs.config.wsMinPacketInterval){console.log("video Websocket: did not recv data over "+t+" ms")}if(t>n.wfs.config.wsMaxPacketInterval&&!n.isForceClosed){n.unload();console.log("video Websocket data not received in "+n.wfs.config.wsMaxPacketInterval/1e3+"s, open again...");var r={type:a.ErrorTypes.NETWORK_ERROR};r.details=a.ErrorDetails.NETWORK_RECV_DATA_TIMEOUT;r.fatal=true;n.wfs.trigger(f.default.ERROR,r)}}else{n.lastRecvDataTime=performance.now()}},this.wfs.config.wsMinPacketInterval)}},{key:"kill_timer",value:function e(){if(this.timer){console.log("video Websocket close: clear timer");clearInterval(this.timer);this.timer=undefined}}},{key:"destroy",value:function e(){console.log("WebsocketLoader +++");this.kill_timer();this.isForceClosed=true;!!this.client&&this.client.close();!!this.audioLoader&&this.audioLoader.closeWS();!!this.audioLoader&&n.default.prototype.destroy.call(this.audioLoader);!!this.processor&&this.processor.terminate();this.processor=null;n.default.prototype.destroy.call(this);console.log("WebsocketLoader ---")}},{key:"onWebsocketAttaching",value:function e(t){this.kill_timer();this.create_timer();switch(t.mediaType){case"MJPEG":this.mediaCode=1;this.ctx=t.media.ctx.getContext("2d");break;case"H265Raw":this.mediaCode=2;this.ctx=t.media.ctx;this.pts=0;this.processor=this.initH265DecodeWorker();break;case"H264Raw":default:this.mediaCode=0;break}this.media=t.media;this.mediaType=t.mediaType;this.extraData=t.extraData;if(t.websocket instanceof WebSocket){this.client=t.websocket;this.client.onopen=this.initSocketClient.bind(this);this.client.onclose=this.closeSocketClient.bind(this);this.client.onerror=this.errorSocketClient.bind(this)}if(t.audioInfo){this.audioLoader=new o.default(this.wfs);this.audioLoader.onWSAttaching(t.audioInfo)}}},{key:"errorSocketClient",value:function e(t){this.unload();console.log("video WebSocket error: ",t)}},{key:"closeSocketClient",value:function e(t){this.unload();console.log("video Websocket closed: ",t)}},{key:"initSocketClient",value:function e(t){this.load();console.log("video Websocket Open!")}},{key:"receiveSocketMessage",value:function e(t){if(this.isForceClosed){return}this.lastRecvDataTime=performance.now();var r=new Uint8Array(t.data);var n=new DataView(r.buffer);var i=1414092865;var a=16;var o=this.lastRecvDataTime;if(n.byteLength>=8){var s=n.getUint32(0,true);var u=n.getUint32(4,true);if(s==i&&u+a==n.byteLength){o=Number(n.getBigUint64(8,true)/BigInt(1e3));this.buf=r.subarray(a)}else{this.buf=r}}else{this.buf=r}if(this.mediaCode===0){this.wfs.trigger(f.default.H264_DATA_PARSING,{data:this.buf,pts:o})}else if(this.mediaCode===1){this.procMjpeg(t.data)}else if(this.mediaCode===2){this.procH265(this.buf,o)}if(this.wfs.config.recording){this.wfs.trigger(f.default.H264_DATA_APPENDING,{data:this.buf,pts:o})}}},{key:"procH265",value:function e(t,r){if(this.h265Demuxer){this.wfs.trigger(f.default.H265_DATA_PARSING,{data:t,pts:r});return}this.processor.postMessage({type:"h265",data:t})}},{key:"initH265DecodeWorker",value:function e(){var a=this;if(this.h265Demuxer){return null}var t=new Worker("./js/h265_decode_worker.js");t.onmessage=function(e){var t=e.data;var r=t.type;var n=new Uint8Array(t.data);switch(r){case"yuv":var i={data:n,width:t.width,height:t.height};a.displayVideoFrame(i);break;default:console.log("do nothing")}};return t}},{key:"procMjpeg",value:function e(t){var r=this;if(this.extraData){if(!this.extraData.isDrawImg)return;var n=new FileReader;n.onload=function(e){if(e.target.readyState===FileReader.DONE){var f=r.ctx;var c=new Image;var l=r.extraData.mjpeg_w;var d=r.extraData.mjpeg_h;var h=r.extraData.sizeOptionInd;var p=r.extraData.getObjectFitSize;c.onload=function(){f.clearRect(0,0,l,d);if(h===1){var e=p(h,l,d,this.width,this.height),t=e.sx,r=e.sy,n=e.swidth,i=e.sheight,a=e.x,o=e.y,s=e.width,u=e.height;f.drawImage(c,t,r,n,i,a,o,s,u)}else{f.drawImage(c,0,0,l,d)}};c.src=e.target.result}};n.readAsDataURL(t.slice(16))}else{console.log("extraData is undefined");this.extraData=this.wfs.extraData}}},{key:"onWebsocketDataUploading",value:function e(t){this.client.send(t.data)}},{key:"load",value:function e(){if(this.mediaCode===0||this.mediaCode===2){this.client.binaryType="arraybuffer"}this.client.onmessage=this.receiveSocketMessage.bind(this);this.isLoaded=true}},{key:"unload",value:function e(){this.isLoaded=false;if(this.mediaCode===1){this.ctx.clearRect(0,0,this.extraData.mjpeg_w,this.extraData.mjpeg_h)}}},{key:"displayVideoFrame",value:function e(t){var r=this.extraData.mjpeg_w;var n=this.extraData.mjpeg_h;var i=this.extraData.sizeOptionInd;var a=3840;if(!this.webglPlayer){var o=this.ctx;this.webglPlayer=new m.default(o)}if(i===1){var s=this.extraData.getObjectFitSize;var u=s(i,r,n,t.width,t.height),f=u.sx,c=u.sy,l=u.swidth,d=u.sheight,h=u.x,p=u.y,v=u.width,y=u.height;this.webglPlayer.setSize(r,n,a);this.webglPlayer.renderFrame(t.data,t.width,t.height,h,p,v,y)}else{this.webglPlayer.setSize(t.width,t.height,a);this.webglPlayer.renderFrame(t.data,t.width,t.height,0,0,t.width,t.height)}}}]);return r}(n.default);var R=r.default=k},{"../audio/audio-loader":7,"../demux/h264-demuxer":11,"../errors":12,"../event-handler":13,"../events":14,"../h265/h265-demuxer":17,"../helper/aac":20,"../utils/webgl-payer":29,"../wfs":30}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,s(n.key),n)}}function o(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function s(e){var t=u(e,"string");return"symbol"==i(t)?t:String(t)}function u(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var f=function(){function h(){n(this,h)}o(h,null,[{key:"init",value:function e(){h.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in h.types){if(h.types.hasOwnProperty(t)){h.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]}}var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);h.HDLR_TYPES={video:r,audio:n};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);var a=new Uint8Array([0,0,0,0,0,0,0,0]);h.STTS=h.STSC=h.STCO=a;h.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);h.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);h.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);h.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]);var s=new Uint8Array([97,118,99,49]);var u=new Uint8Array([0,0,0,1]);h.FTYP=h.box(h.types.ftyp,o,u,o,s);h.DINF=h.box(h.types.dinf,h.box(h.types.dref,i))}},{key:"box",value:function e(t){var r=Array.prototype.slice.call(arguments,1),n=8,i=r.length,a=i,o;while(i--){n+=r[i].byteLength}o=new Uint8Array(n);o[0]=n>>24&255;o[1]=n>>16&255;o[2]=n>>8&255;o[3]=n&255;o.set(t,4);for(i=0,n=8;i<a;i++){o.set(r[i],n);n+=r[i].byteLength}return o}},{key:"hdlr",value:function e(t){return h.box(h.types.hdlr,h.HDLR_TYPES[t])}},{key:"mdat",value:function e(t){return h.box(h.types.mdat,t)}},{key:"mdhd",value:function e(t,r){r*=t;return h.box(h.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}},{key:"mdia",value:function e(t){return h.box(h.types.mdia,h.mdhd(t.timescale,t.duration),h.hdlr(t.type),h.minf(t))}},{key:"mfhd",value:function e(t){return h.box(h.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}},{key:"minf",value:function e(t){if(t.type==="audio"){return h.box(h.types.minf,h.box(h.types.smhd,h.SMHD),h.DINF,h.stbl(t))}else{return h.box(h.types.minf,h.box(h.types.vmhd,h.VMHD),h.DINF,h.stbl(t))}}},{key:"moof",value:function e(t,r,n){return h.box(h.types.moof,h.mfhd(t),h.traf(n,r))}},{key:"moov",value:function e(t){var r=t.length,n=[];while(r--){n[r]=h.trak(t[r])}return h.box.apply(null,[h.types.moov,h.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(h.mvex(t)))}},{key:"mvex",value:function e(t){var r=t.length,n=[];while(r--){n[r]=h.trex(t[r])}return h.box.apply(null,[h.types.mvex].concat(n))}},{key:"mvhd",value:function e(t,r){r=0;var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return h.box(h.types.mvhd,n)}},{key:"sdtp",value:function e(t){var r=t.samples||[],n=new Uint8Array(4+r.length),i,a;for(a=0;a<r.length;a++){i=r[a].flags;n[a+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy}return h.box(h.types.sdtp,n)}},{key:"stbl",value:function e(t){return h.box(h.types.stbl,h.stsd(t),h.box(h.types.stts,h.STTS),h.box(h.types.stsc,h.STSC),h.box(h.types.stsz,h.STSZ),h.box(h.types.stco,h.STCO))}},{key:"avc1",value:function e(t){var r=[],n=[],i,a,o;for(i=0;i<t.sps.length;i++){a=t.sps[i];o=a.byteLength;r.push(o>>>8&255);r.push(o&255);r=r.concat(Array.prototype.slice.call(a))}for(i=0;i<t.pps.length;i++){a=t.pps[i];o=a.byteLength;n.push(o>>>8&255);n.push(o&255);n=n.concat(Array.prototype.slice.call(a))}var s=h.box(h.types.avcC,new Uint8Array([1,r[3],r[4],r[5],252|3,224|t.sps.length].concat(r).concat([t.pps.length]).concat(n))),u=t.width,f=t.height;return h.box(h.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,98,105,110,101,108,112,114,111,46,114,117,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,h.box(h.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function e(t){var r=t.config.byteLength;var n=new Uint8Array(26+r+3);n.set([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5,r]);n.set(t.config,26);n.set([6,1,2],26+r);return n}},{key:"mp4a",value:function e(t){var r=t.audiosamplerate;return h.box(h.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,r&255,0,0]),h.box(h.types.esds,h.esds(t)))}},{key:"stsd",value:function e(t){if(t.type==="audio"){return h.box(h.types.stsd,h.STSD,h.mp4a(t))}else{return h.box(h.types.stsd,h.STSD,h.avc1(t))}}},{key:"tkhd",value:function e(t){var r=t.id,n=t.duration,i=t.width,a=t.height,o=t.volume;return h.box(h.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,0,0,0,0,0,0,0,0,0,0,0,0,o>>0&255,o%1*10>>0&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,a>>8&255,a&255,0,0]))}},{key:"traf",value:function e(t,r){var n=h.sdtp(t),i=t.id;return h.box(h.types.traf,h.box(h.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),h.box(h.types.tfdt,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),h.trun(t,n.length+16+16+8+16+8+8),n)}},{key:"trak",value:function e(t){t.duration=t.duration||4294967295;return h.box(h.types.trak,h.tkhd(t),h.mdia(t))}},{key:"trex",value:function e(t){var r=t.id;return h.box(h.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function e(t,r){var n=t.samples||[],i=n.length,a=12+16*i,o=new Uint8Array(a),s,u,f,c,l,d;r+=8+a;o.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0);for(s=0;s<i;s++){u=n[s];f=u.duration;c=u.size;l=u.flags;d=u.cts;o.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,l.isLeading<<2|l.dependsOn,l.isDependedOn<<6|l.hasRedundancy<<4|l.paddingValue<<1|l.isNonSync,l.degradPrio&240<<8,l.degradPrio&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*s)}return h.box(h.types.trun,o)}},{key:"initSegment",value:function e(t){if(!h.types){h.init()}var r=h.moov(t),n;n=new Uint8Array(h.FTYP.byteLength+r.byteLength);n.set(h.FTYP);n.set(r,h.FTYP.byteLength);return n}}]);return h}();var c=r.default=f},{}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var n=a(e("../helper/aac"));var w=a(e("../events"));var i=e("../utils/logger");var E=a(e("../remux/mp4-generator"));var f=e("../errors");e("../utils/polyfill");function a(e){return e&&e.__esModule?e:{default:e}}function o(e){"@babel/helpers - typeof";return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,l(n.key),n)}}function c(e,t,r){if(t)u(e.prototype,t);if(r)u(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function l(e){var t=d(e,"string");return"symbol"==o(t)?t:String(t)}function d(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var h=function(){function n(e,t,r){s(this,n);this.observer=e;this.id=t;this.config=r;this.ISVedioGenerated=false;this.PES_TIMESCALE=this.config.timescale;this.H264_TIMEBASE=this.config.mp4Duration;this.genISFailCount=0;this.nextAvcDts=this.PES_TIMESCALE+300;this._initPTS=this._initDTS=undefined;this.lastDTS=0;this.baseDecodeTime=0}c(n,[{key:"passthrough",get:function e(){return false}},{key:"destroy",value:function e(){}},{key:"insertDiscontinuity",value:function e(){this._initPTS=this._initDTS=undefined}},{key:"pushVideo",value:function e(t,r,n){this.level=t;this.sn=r;if(!this.ISVedioGenerated){this.generateVideoIS(n)}if(!this.ISVedioGenerated){return}if(this.config.mode==="both"){this.remuxVideoWithAudio(n)}else{this.remuxVideo_2(n)}}},{key:"remuxVideoWithAudio",value:function e(t){var r=8,n,i,a=t.samples,o=[];n=new Uint8Array(t.len+4*t.nbNalu+8);var s=new DataView(n.buffer);s.setUint32(0,n.byteLength);n.set(E.default.types.mdat,4);var u=0;for(var f=0;f<a.length;f++){var c=a[f],l=0;while(c.units.units.length){var d=c.units.units.shift();s.setUint32(r,d.data.byteLength);r+=4;n.set(d.data,r);r+=d.data.byteLength;l+=4+d.data.byteLength}var h=(c.dts-this.lastDTS)/1e3*this.PES_TIMESCALE;if(this.lastDTS==0){h=500}u+=h;o.push({size:l,duration:h,cts:0,flags:{isLeading:0,hasRedundancy:0,degradPrio:0,dependsOn:c.key?2:1,isDependedOn:c.key?1:0,isNonSync:c.key?0:1}});this.lastDTS=c.dts}t.len=0;t.samples=o;i=E.default.moof(t.sequenceNumber++,this.baseDecodeTime,t);this.baseDecodeTime+=u;t.samples=[];var p={data1:i,data2:n,type:"video"};this.observer.trigger(w.default.FRAG_PARSING_DATA,p);return p}},{key:"remuxVideo_2",value:function e(t){var r=8,n,i,a=t.samples,o=[];n=new Uint8Array(t.len+4*t.nbNalu+8);var s=new DataView(n.buffer);s.setUint32(0,n.byteLength);n.set(E.default.types.mdat,4);var u,f,c;for(var l=0;l<a.length;l++){var d=a[l],h=0;while(d.units.units.length){var p=d.units.units.shift();s.setUint32(r,p.data.byteLength);r+=4;n.set(p.data,r);r+=p.data.byteLength;h+=4+p.data.byteLength}var v=d.pts-this._initPTS;var y=d.dts-this._initDTS;y=Math.min(v,y);if(c!==undefined){u=this._PTSNormalize(v,c);f=this._PTSNormalize(y,c)}else{var m=this.nextAvcDts,b;u=this._PTSNormalize(v,m);f=this._PTSNormalize(y,m);if(m){b=Math.round(f-m);if(Math.abs(b)<600){if(b){f=m;u=Math.max(u-b,f)}}}this.firstPTS=Math.max(0,u);this.firstDTS=Math.max(0,f)}o.push({size:h,duration:this.H264_TIMEBASE,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:d.key?2:1,isNonSync:d.key?0:1}});c=f}this.nextAvcDts=f;t.len=0;t.nbNalu=0;t.dropped=0;if(o.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var g=o[0].flags;g.dependsOn=2;g.isNonSync=0}t.samples=o;i=E.default.moof(t.sequenceNumber++,f,t);this.config.dtsnorm=f;t.samples=[];var _={data1:i,data2:n,type:"video"};this.observer.trigger(w.default.FRAG_PARSING_DATA,_);return _}},{key:"generateVideoIS",value:function e(t){var r=this.observer,n=t.samples,i={},a=this._initPTS===undefined,o,s;if(a){o=s=Infinity}if(t.sps&&t.pps&&n.length){t.timescale=this.PES_TIMESCALE;t.duration=this.config.mp4Duration;i.video={container:"video/mp4",initSegment:E.default.initSegment([t]),metadata:{width:t.width,height:t.height}};if(a){o=Math.min(o,n[0].pts-this.H264_TIMEBASE);s=Math.min(s,n[0].dts-this.H264_TIMEBASE)}}if(Object.keys(i).length){var u={tracks:i};r.trigger(w.default.FRAG_PARSING_INIT_SEGMENT,u);this.ISVedioGenerated=true;this.genISFailCount=0;if(a){this._initPTS=o;this._initDTS=s}}else{this.genISFailCount++;if(this.genISFailCount>60){console.log("generateVideoIS ERROR: ",f.ErrorTypes.MEDIA_ERROR)}}}},{key:"_PTSNormalize",value:function e(t,r){var n;if(r===undefined){return t}if(r<t){n=-8589934592}else{n=8589934592}while(Math.abs(t-r)>4294967296){t+=n}return t}}]);return n}();var p=r.default=h},{"../errors":12,"../events":14,"../helper/aac":20,"../remux/mp4-generator":23,"../utils/logger":26,"../utils/polyfill":28}],25:[function(Gt,e,r){(function(Bt){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;function jt(e){"@babel/helpers - typeof";return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jt(e)}var e=function(){var Nt=typeof document!=="undefined"&&document.currentScript?document.currentScript.src:undefined;return function(s){s=s||{};var s=typeof s!="undefined"?s:{};var M,u;s["ready"]=new Promise(function(e,t){M=e;u=t});["_malloc","_free","_turn_on_encoder","_pcm_2_aac","_getByteLen","_free_buf","_fflush","___set_stack_limits","onRuntimeInitialized"].forEach(function(t){if(!Object.getOwnPropertyDescriptor(s["ready"],t)){Object.defineProperty(s["ready"],t,{get:function e(){return P("You are getting "+t+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")},set:function e(){return P("You are setting "+t+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})}});var F=Object.assign({},s);var r=[];var N="./this.program";var t=function e(t,r){throw r};var j=true;var e=false;var B=false;var G=false;if(s["ENVIRONMENT"]){throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)")}var n="";function W(e){if(s["locateFile"]){return s["locateFile"](e,n)}return n+e}var H,V,i,z;function Y(e){if(e instanceof xe)return;var t=e;if(e&&jt(e)=="object"&&e.stack){t=[e,e.stack]}f("exiting due to exception: "+t)}if(G){if((typeof Bt==="undefined"?"undefined":jt(Bt))=="object"&&typeof Gt==="function"||(typeof window==="undefined"?"undefined":jt(window))=="object"||typeof importScripts=="function")throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");if(typeof read!="undefined"){H=function e(t){return read(t)}}i=function e(t){var r;if(typeof readbuffer=="function"){return new Uint8Array(readbuffer(t))}r=read(t,"binary");p(jt(r)=="object");return r};V=function e(t,r,n){setTimeout(function(){return r(i(t))},0)};if(typeof scriptArgs!="undefined"){r=scriptArgs}else if(typeof arguments!="undefined"){r=arguments}if(typeof quit=="function"){t=function e(t,r){Y(r);quit(t)}}if(typeof print!="undefined"){if(typeof console=="undefined")console={};console.log=print;console.warn=console.error=typeof printErr!="undefined"?printErr:print}}else if(j||e){if(e){n=self.location.href}else if(typeof document!="undefined"&&document.currentScript){n=document.currentScript.src}if(Nt){n=Nt}if(n.indexOf("blob:")!==0){n=n.substr(0,n.replace(/[?#].*/,"").lastIndexOf("/")+1)}else{n=""}if(!((typeof window==="undefined"?"undefined":jt(window))=="object"||typeof importScripts=="function"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");{H=function e(t){var r=new XMLHttpRequest;r.open("GET",t,false);r.send(null);return r.responseText};if(e){i=function e(t){var r=new XMLHttpRequest;r.open("GET",t,false);r.responseType="arraybuffer";r.send(null);return new Uint8Array(r.response)}}V=function e(t,r,n){var i=new XMLHttpRequest;i.open("GET",t,true);i.responseType="arraybuffer";i.onload=function(){if(i.status==200||i.status==0&&i.response){r(i.response);return}n()};i.onerror=n;i.send(null)}}z=function e(t){return document.title=t}}else{throw new Error("environment detection error")}var a=s["print"]||console.log.bind(console);var f=s["printErr"]||console.warn.bind(console);Object.assign(s,F);F=null;ht();if(s["arguments"])r=s["arguments"];o("arguments","arguments_");if(s["thisProgram"])N=s["thisProgram"];o("thisProgram","thisProgram");if(s["quit"])t=s["quit"];o("quit","quit_");p(typeof s["memoryInitializerPrefixURL"]=="undefined","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead");p(typeof s["pthreadMainPrefixURL"]=="undefined","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead");p(typeof s["cdInitializerPrefixURL"]=="undefined","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead");p(typeof s["filePackagePrefixURL"]=="undefined","Module.filePackagePrefixURL option was removed, use Module.locateFile instead");p(typeof s["read"]=="undefined","Module.read option was removed (modify read_ in JS)");p(typeof s["readAsync"]=="undefined","Module.readAsync option was removed (modify readAsync in JS)");p(typeof s["readBinary"]=="undefined","Module.readBinary option was removed (modify readBinary in JS)");p(typeof s["setWindowTitle"]=="undefined","Module.setWindowTitle option was removed (modify setWindowTitle in JS)");p(typeof s["TOTAL_MEMORY"]=="undefined","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY");o("read","read_");o("readAsync","readAsync");o("readBinary","readBinary");o("setWindowTitle","setWindowTitle");p(!e,"worker environment detected but not enabled at build time.  Add 'worker' to `-sENVIRONMENT` to enable.");p(!B,"node environment detected but not enabled at build time.  Add 'node' to `-sENVIRONMENT` to enable.");p(!G,"shell environment detected but not enabled at build time.  Add 'shell' to `-sENVIRONMENT` to enable.");var q=4;function o(t,r){if(!Object.getOwnPropertyDescriptor(s,t)){Object.defineProperty(s,t,{configurable:true,get:function e(){P("Module."+t+" has been replaced with plain "+r+" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}})}}function X(e){if(Object.getOwnPropertyDescriptor(s,e)){P("`Module."+e+"` was supplied but `"+e+"` not included in INCOMING_MODULE_JS_API")}}function K(e){return e==="FS_createPath"||e==="FS_createDataFile"||e==="FS_createPreloadedFile"||e==="FS_unlink"||e==="addRunDependency"||e==="FS_createLazyFile"||e==="FS_createDevice"||e==="removeRunDependency"}function J(r){if(typeof globalThis!=="undefined"&&!Object.getOwnPropertyDescriptor(globalThis,r)){Object.defineProperty(globalThis,r,{configurable:true,get:function e(){var t="`"+r+"` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line";if(K(r)){t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"}D(t);return undefined}})}}function Z(r){if(!Object.getOwnPropertyDescriptor(s,r)){Object.defineProperty(s,r,{configurable:true,get:function e(){var t="'"+r+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";if(K(r)){t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"}P(t)}})}}var c;if(s["wasmBinary"])c=s["wasmBinary"];o("wasmBinary","wasmBinary");var Q=s["noExitRuntime"]||true;o("noExitRuntime","noExitRuntime");if((typeof WebAssembly==="undefined"?"undefined":jt(WebAssembly))!="object"){P("no native wasm support detected")}var l;var d=false;var h;function p(e,t){if(!e){P("Assertion failed"+(t?": "+t:""))}}function $(e,t,r){var n=t+r;var i="";while(!(t>=n)){var a=e[t++];if(!a)return i;if(!(a&128)){i+=String.fromCharCode(a);continue}var o=e[t++]&63;if((a&224)==192){i+=String.fromCharCode((a&31)<<6|o);continue}var s=e[t++]&63;if((a&240)==224){a=(a&15)<<12|o<<6|s}else{if((a&248)!=240)D("Invalid UTF-8 leading byte 0x"+a.toString(16)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!");a=(a&7)<<18|o<<12|s<<6|e[t++]&63}if(a<65536){i+=String.fromCharCode(a)}else{var u=a-65536;i+=String.fromCharCode(55296|u>>10,56320|u&1023)}}return i}function v(e,t){return e?$(m,e,t):""}function ee(e,t,r,n){if(!(n>0))return 0;var i=r;var a=r+n-1;for(var o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343){var u=e.charCodeAt(++o);s=65536+((s&1023)<<10)|u&1023}if(s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6;t[r++]=128|s&63}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12;t[r++]=128|s>>6&63;t[r++]=128|s&63}else{if(r+3>=a)break;if(s>1114111)D("Invalid Unicode code point 0x"+s.toString(16)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF).");t[r++]=240|s>>18;t[r++]=128|s>>12&63;t[r++]=128|s>>6&63;t[r++]=128|s&63}}t[r]=0;return r-i}function te(e,t,r){p(typeof r=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!");return ee(e,m,t,r)}function re(e){var t=0;for(var r=0;r<e.length;++r){var n=e.charCodeAt(r);if(n<=127){t++}else if(n<=2047){t+=2}else if(n>=55296&&n<=57343){t+=4;++r}else{t+=3}}return t}var ne,y,m,ie,ae,oe,b,se,ue;function fe(e){ne=e;s["HEAP8"]=y=new Int8Array(e);s["HEAP16"]=ie=new Int16Array(e);s["HEAP32"]=oe=new Int32Array(e);s["HEAPU8"]=m=new Uint8Array(e);s["HEAPU16"]=ae=new Uint16Array(e);s["HEAPU32"]=b=new Uint32Array(e);s["HEAPF32"]=se=new Float32Array(e);s["HEAPF64"]=ue=new Float64Array(e)}var g=5242880;if(s["TOTAL_STACK"])p(g===s["TOTAL_STACK"],"the stack size can no longer be determined at runtime");var _=s["INITIAL_MEMORY"]||67108864;o("INITIAL_MEMORY","INITIAL_MEMORY");p(_>=g,"INITIAL_MEMORY should be larger than TOTAL_STACK, was "+_+"! (TOTAL_STACK="+g+")");p(typeof Int32Array!="undefined"&&typeof Float64Array!=="undefined"&&Int32Array.prototype.subarray!=undefined&&Int32Array.prototype.set!=undefined,"JS engine does not provide full typed array support");p(!s["wasmMemory"],"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally");p(_==67108864,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");var w;function ce(){var e=I();p((e&3)==0);b[e>>2]=34821223;b[e+4>>2]=2310721022;b[0]=1668509029}function E(){if(d)return;var e=I();var t=b[e>>2];var r=b[e+4>>2];if(t!=34821223||r!=2310721022){P("Stack overflow! Stack cookie has been overwritten at 0x"+e.toString(16)+", expected hex dwords 0x89BACDFE and 0x2135467, but received 0x"+r.toString(16)+" 0x"+t.toString(16))}if(b[0]!==1668509029)P("Runtime error: The application has corrupted its heap memory area (address zero)!")}(function(){var e=new Int16Array(1);var t=new Int8Array(e.buffer);e[0]=25459;if(t[0]!==115||t[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})();var le=[];var de=[];var he=[];var S=false;function pe(){return Q}function ve(){if(s["preRun"]){if(typeof s["preRun"]=="function")s["preRun"]=[s["preRun"]];while(s["preRun"].length){be(s["preRun"].shift())}}De(le)}function ye(){p(!S);S=true;E();xt(Rt(),I());De(de)}function me(){E();if(s["postRun"]){if(typeof s["postRun"]=="function")s["postRun"]=[s["postRun"]];while(s["postRun"].length){_e(s["postRun"].shift())}}De(he)}function be(e){le.unshift(e)}function ge(e){de.unshift(e)}function _e(e){he.unshift(e)}p(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");p(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");p(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");p(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var A=0;var T=null;var k=null;var R={};function we(e){A++;if(s["monitorRunDependencies"]){s["monitorRunDependencies"](A)}if(e){p(!R[e]);R[e]=1;if(T===null&&typeof setInterval!="undefined"){T=setInterval(function(){if(d){clearInterval(T);T=null;return}var e=false;for(var t in R){if(!e){e=true;f("still waiting on run dependencies:")}f("dependency: "+t)}if(e){f("(end of list)")}},1e4)}}else{f("warning: run dependency added without ID")}}function Ee(e){A--;if(s["monitorRunDependencies"]){s["monitorRunDependencies"](A)}if(e){p(R[e]);delete R[e]}else{f("warning: run dependency removed without ID")}if(A==0){if(T!==null){clearInterval(T);T=null}if(k){var t=k;k=null;t()}}}function P(e){{if(s["onAbort"]){s["onAbort"](e)}}e="Aborted("+e+")";f(e);d=true;h=1;var t=new WebAssembly.RuntimeError(e);u(t);throw t}var L={error:function e(){P("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM")},init:function e(){L.error()},createDataFile:function e(){L.error()},createPreloadedFile:function e(){L.error()},createLazyFile:function e(){L.error()},open:function e(){L.error()},mkdev:function e(){L.error()},registerDevice:function e(){L.error()},analyzePath:function e(){L.error()},loadFilesFromDB:function e(){L.error()},ErrnoError:function e(){L.error()}};s["FS_createDataFile"]=L.createDataFile;s["FS_createPreloadedFile"]=L.createPreloadedFile;var Se="data:application/octet-stream;base64,";function Ae(e){return e.startsWith(Se)}function Te(e){return e.startsWith("file://")}function O(r,n){return function(){var e=r;var t=n;if(!n){t=s["asm"]}p(S,"native function `"+e+"` called before runtime initialization");if(!t[r]){p(t[r],"exported native function `"+e+"` not found")}return t[r].apply(null,arguments)}}var x;x="libfaac.wasm";if(!Ae(x)){x=W(x)}function ke(e){try{if(e==x&&c){return new Uint8Array(c)}if(i){return i(e)}throw"both async and sync fetching of the wasm failed"}catch(e){P(e)}}function Re(){if(!c&&(j||e)){if(typeof fetch=="function"){return fetch(x,{credentials:"same-origin"}).then(function(e){if(!e["ok"]){throw"failed to load wasm binary file at '"+x+"'"}return e["arrayBuffer"]()}).catch(function(){return ke(x)})}}return Promise.resolve().then(function(){return ke(x)})}function Pe(){var r={env:pt,wasi_snapshot_preview1:pt};function t(e,t){var r=e.exports;s["asm"]=r;l=s["asm"]["memory"];p(l,"memory not found in wasm exports");fe(l.buffer);w=s["asm"]["__indirect_function_table"];p(w,"table not found in wasm exports");ge(s["asm"]["__wasm_call_ctors"]);Ee("wasm-instantiate")}we("wasm-instantiate");var n=s;function i(e){p(s===n,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?");n=null;t(e["instance"])}function a(e){return Re().then(function(e){return WebAssembly.instantiate(e,r)}).then(function(e){return e}).then(e,function(e){f("failed to asynchronously prepare wasm: "+e);if(Te(x)){f("warning: Loading from a file URI ("+x+") is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing")}P(e)})}function e(){if(!c&&typeof WebAssembly.instantiateStreaming=="function"&&!Ae(x)&&typeof fetch=="function"){return fetch(x,{credentials:"same-origin"}).then(function(e){var t=WebAssembly.instantiateStreaming(e,r);return t.then(i,function(e){f("wasm streaming compile failed: "+e);f("falling back to ArrayBuffer instantiation");return a(i)})})}else{return a(i)}}if(s["instantiateWasm"]){try{var o=s["instantiateWasm"](r,t);return o}catch(e){f("Module.instantiateWasm callback failed with error: "+e);return false}}e().catch(u);return{}}var Le;var Oe;function xe(e){this.name="ExitStatus";this.message="Program terminated with exit("+e+")";this.status=e}function De(e){while(e.length>0){e.shift()(s)}}function Ce(e){D("warning: build with -sDEMANGLE_SUPPORT to link in libcxxabi demangling");return e}function Ie(e){var t=/\b_Z[\w\d_]+/g;return e.replace(t,function(e){var t=Ce(e);return e===t?e:t+" ["+e+"]"})}function Ue(){var t=new Error;if(!t.stack){try{throw new Error}catch(e){t=e}if(!t.stack){return"(no stack trace available)"}}return t.stack.toString()}function D(e){if(!D.shown)D.shown={};if(!D.shown[e]){D.shown[e]=1;f(e)}}function Me(e,t){p(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)");y.set(e,t)}function Fe(e,t,r,n){P("Assertion failed: "+v(e)+", at: "+[t?v(t):"unknown filename",r,n?v(n):"unknown function"])}function Ne(e){e=e>>>0;P("stack overflow (Attempt to set SP to 0x"+e.toString(16)+", with stack limits [0x"+I().toString(16)+" - 0x"+Rt().toString(16)+"])")}function je(){P("native code called abort()")}function Be(e,t,r){m.copyWithin(e,t,t+r)}var Ge;Ge=function e(){return performance.now()};function We(e){var t=m.length;e=e>>>0;return false}var He={varargs:undefined,get:function e(){p(He.varargs!=undefined);He.varargs+=4;var t=oe[He.varargs-4>>2];return t},getStr:function e(t){var r=v(t);return r}};function Ve(e){h=e;if(!pe()){if(s["onExit"])s["onExit"](e);d=true}t(e,new xe(e))}function ze(e,t){h=e;Ft();if(pe()&&!t){var r="program exited (with status: "+e+"), but EXIT_RUNTIME is not set, so halting execution but not exiting the runtime or preventing further async execution (build with EXIT_RUNTIME=1, if you want a true shutdown)";u(r);f(r)}Ve(e)}var Ye=ze;function qe(e){P("fd_close called without SYSCALLS_REQUIRE_FILESYSTEM")}function Xe(e,t,r,n,i){return 70}var Ke=[null,[],[]];function Je(e,t){var r=Ke[e];p(r);if(t===0||t===10){(e===1?a:f)($(r,0));r.length=0}else{r.push(t)}}function Ze(){At(0);if(Ke[1].length)Je(1,10);if(Ke[2].length)Je(2,10)}function Qe(e,t,r,n){var i=0;for(var a=0;a<r;a++){var o=b[t>>2];var s=b[t+4>>2];t+=8;for(var u=0;u<s;u++){Je(e,m[o+u])}i+=s}b[n>>2]=i;return 0}function $e(e,t){p(e<16384);if(e<128){t.push(e)}else{t.push(e%128|128,e>>7)}}function et(e){var t={i:"i32",j:"i64",f:"f32",d:"f64",p:"i32"};var r={parameters:[],results:e[0]=="v"?[]:[t[e[0]]]};for(var n=1;n<e.length;++n){p(e[n]in t,"invalid signature char: "+e[n]);r.parameters.push(t[e[n]])}return r}function tt(e,t){if(typeof WebAssembly.Function=="function"){return new WebAssembly.Function(et(t),e)}var r=[1,96];var n=t.slice(0,1);var i=t.slice(1);var a={i:127,p:127,j:126,f:125,d:124};$e(i.length,r);for(var o=0;o<i.length;++o){p(i[o]in a,"invalid signature char: "+i[o]);r.push(a[i[o]])}if(n=="v"){r.push(0)}else{r.push(1,a[n])}var s=[0,97,115,109,1,0,0,0,1];$e(r.length,s);s.push.apply(s,r);s.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var u=new WebAssembly.Module(new Uint8Array(s));var f=new WebAssembly.Instance(u,{e:{f:e}});var c=f.exports["f"];return c}var C=[];function rt(e){var t=C[e];if(!t){if(e>=C.length)C.length=e+1;C[e]=t=w.get(e)}p(w.get(e)==t,"JavaScript-side Wasm function table mirror is out of date!");return t}function nt(e,t){if(it){for(var r=e;r<e+t;r++){var n=rt(r);if(n){it.set(n,r)}}}}var it=undefined;var at=[];function ot(){if(at.length){return at.pop()}try{w.grow(1)}catch(e){if(!(e instanceof RangeError)){throw e}throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return w.length-1}function st(e,t){w.set(e,t);C[e]=w.get(e)}var ut=1;function ft(e,t,r){for(var n=0;n<e.length;++n){p(e.charCodeAt(n)===(e.charCodeAt(n)&255));y[t++>>0]=e.charCodeAt(n)}if(!r)y[t>>0]=0}function ct(e){var t=s["_"+e];p(t,"Cannot call unknown function "+e+", make sure it is exported");return t}function lt(e,t,r,n,i){var a={string:function e(t){var r=0;if(t!==null&&t!==undefined&&t!==0){var n=(t.length<<2)+1;r=Ot(n);te(t,r,n)}return r},array:function e(t){var r=Ot(t.length);Me(t,r);return r}};function o(e){if(t==="string"){return v(e)}if(t==="boolean")return Boolean(e);return e}var s=ct(e);var u=[];var f=0;p(t!=="array",'Return type should not be "array".');if(n){for(var c=0;c<n.length;c++){var l=a[r[c]];if(l){if(f===0)f=Pt();u[c]=l(n[c])}else{u[c]=n[c]}}}var d=s.apply(null,u);function h(e){if(f!==0)Lt(f);return o(e)}d=h(d);return d}var dt=true;function ht(){X("fetchSettings")}var pt={__assert_fail:Fe,__handle_stack_overflow:Ne,abort:je,emscripten_memcpy_big:Be,emscripten_resize_heap:We,exit:Ye,fd_close:qe,fd_seek:Xe,fd_write:Qe};var vt=Pe();var yt=s["___wasm_call_ctors"]=O("__wasm_call_ctors");var mt=s["_turn_on_encoder"]=O("turn_on_encoder");var bt=s["_pcm_2_aac"]=O("pcm_2_aac");var gt=s["_malloc"]=O("malloc");var _t=s["_free"]=O("free");var wt=s["_getByteLen"]=O("getByteLen");var Et=s["_free_buf"]=O("free_buf");var St=s["___errno_location"]=O("__errno_location");var At=s["_fflush"]=O("fflush");var Tt=s["_emscripten_stack_init"]=function(){return(Tt=s["_emscripten_stack_init"]=s["asm"]["emscripten_stack_init"]).apply(null,arguments)};var kt=s["_emscripten_stack_get_free"]=function(){return(kt=s["_emscripten_stack_get_free"]=s["asm"]["emscripten_stack_get_free"]).apply(null,arguments)};var Rt=s["_emscripten_stack_get_base"]=function(){return(Rt=s["_emscripten_stack_get_base"]=s["asm"]["emscripten_stack_get_base"]).apply(null,arguments)};var I=s["_emscripten_stack_get_end"]=function(){return(I=s["_emscripten_stack_get_end"]=s["asm"]["emscripten_stack_get_end"]).apply(null,arguments)};var Pt=s["stackSave"]=O("stackSave");var Lt=s["stackRestore"]=O("stackRestore");var Ot=s["stackAlloc"]=O("stackAlloc");var xt=s["___set_stack_limits"]=O("__set_stack_limits");var Dt=s["dynCall_jiji"]=O("dynCall_jiji");var Ct=["run","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","FS_createFolder","FS_createPath","FS_createDataFile","FS_createPreloadedFile","FS_createLazyFile","FS_createLink","FS_createDevice","FS_unlink","getLEB","getFunctionTables","alignFunctionTables","registerFunctions","prettyPrint","getCompilerSetting","print","printErr","callMain","abort","keepRuntimeAlive","wasmMemory","stackAlloc","stackSave","stackRestore","getTempRet0","setTempRet0","writeStackCookie","checkStackCookie","ptrToString","zeroMemory","stringToNewUTF8","exitJS","getHeapMax","emscripten_realloc_buffer","ENV","ERRNO_CODES","ERRNO_MESSAGES","setErrNo","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","DNS","getHostByName","Protocols","Sockets","getRandomDevice","warnOnce","traverseStack","UNWIND_CACHE","convertPCtoSourceLocation","readAsmConstArgsArray","readAsmConstArgs","mainThreadEM_ASM","jstoi_q","jstoi_s","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","safeSetTimeout","asmjsMangle","asyncLoad","alignMemory","mmapAlloc","writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","convertJsFunctionToWasm","freeTableIndexes","functionsInTableMap","getEmptyTableSlot","updateTableMap","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","setValue","getValue","PATH","PATH_FS","intArrayFromString","intArrayToString","AsciiToString","stringToAscii","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","allocateUTF8","allocateUTF8OnStack","writeStringToMemory","writeArrayToMemory","writeAsciiToMemory","SYSCALLS","getSocketFromFD","getSocketAddress","JSEvents","registerKeyEventCallback","specialHTMLTargets","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","currentFullscreenStrategy","restoreOldWindowedStyle","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","demangle","demangleAll","jsStackTrace","stackTrace","ExitStatus","getEnvStrings","checkWasiClock","flush_NO_FILESYSTEM","dlopenMissingError","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","exception_addRef","exception_decRef","Browser","setMainLoop","wget","tempFixedLengthArray","miniTempWebGLFloatBuffers","heapObjectForWebGLType","heapAccessShiftForWebGLHeap","GL","emscriptenWebGLGet","computeUnpackAlignedImageSize","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","writeGLArray","AL","SDL_unicode","SDL_ttfContext","SDL_audio","SDL","SDL_gfx","GLUT","EGL","GLFW_Window","GLFW","GLEW","IDBStore","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate"];Ct.forEach(Z);var It=["ptrToString","zeroMemory","stringToNewUTF8","emscripten_realloc_buffer","setErrNo","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","getHostByName","getRandomDevice","traverseStack","convertPCtoSourceLocation","readAsmConstArgs","mainThreadEM_ASM","jstoi_q","jstoi_s","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","safeSetTimeout","asmjsMangle","asyncLoad","alignMemory","mmapAlloc","writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","reallyNegative","unSign","strLen","reSign","formatString","getSocketFromFD","getSocketAddress","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","getEnvStrings","checkWasiClock","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","ExceptionInfo","exception_addRef","exception_decRef","setMainLoop","heapObjectForWebGLType","heapAccessShiftForWebGLHeap","emscriptenWebGLGet","computeUnpackAlignedImageSize","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","writeGLArray","SDL_unicode","SDL_ttfContext","SDL_audio","GLFW_Window","runAndAbortIfError"];It.forEach(J);var U;k=function e(){if(!U)Mt();if(!U)k=e};function Ut(){Tt();ce()}function Mt(e){e=e||r;if(A>0){return}Ut();ve();if(A>0){return}function t(){if(U)return;U=true;s["calledRun"]=true;if(d)return;ye();M(s);if(s["onRuntimeInitialized"])s["onRuntimeInitialized"]();p(!s["_main"],'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]');me()}if(s["setStatus"]){s["setStatus"]("Running...");setTimeout(function(){setTimeout(function(){s["setStatus"]("")},1);t()},1)}else{t()}E()}function Ft(){var e=a;var t=f;var r=false;a=f=function e(t){r=true};try{Ze()}catch(e){}a=e;f=t;if(r){D("stdio streams had content in them that was not flushed. you should set EXIT_RUNTIME to 1 (see the FAQ), or make sure to emit a newline when you printf etc.");D("(this may also be due to not including full filesystem support - try building with -sFORCE_FILESYSTEM)")}}if(s["preInit"]){if(typeof s["preInit"]=="function")s["preInit"]=[s["preInit"]];while(s["preInit"].length>0){s["preInit"].pop()()}}Mt();return s.ready}}();var t=r.default=e}).call(this)}).call(this,Gt("_process"))},{_process:2}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.logger=r.enableLogs=void 0;function n(e){"@babel/helpers - typeof";return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(){}var i={trace:a,debug:a,log:a,warn:a,info:a,error:a};var o=i;function s(e,t){t="["+e+"] > "+t;return t}function u(n){var i=window.console[n];if(i){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++){t[r]=arguments[r]}if(t[0]){t[0]=s(n,t[0])}i.apply(window.console,t)}}return a}function f(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++){r[n-1]=arguments[n]}r.forEach(function(e){o[e]=t[e]?t[e].bind(t):u(e)})}var c=r.enableLogs=function e(t){if(t===true||n(t)==="object"){f(t,"debug","log","info","warn","error");try{o.log()}catch(e){o=i}}else{o=i}};var l=r.logger=o},{}],27:[function(e,t,r){(function(qt){(function(){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.createEncoderWithModule=Yt;r.createFile=_;r.default=void 0;function zt(e){"@babel/helpers - typeof";return zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zt(e)}var e=function(){var Vt=typeof document!=="undefined"&&document.currentScript?document.currentScript.src:undefined;return function(o){o=o||{};var o=typeof o!="undefined"?o:{};var M,s;o["ready"]=new Promise(function(e,t){M=e;s=t});o["createEncoder"]=function e(t,r){return Yt(o,t,r)};var F=Object.assign({},o);var N=[];var j="./this.program";var B=function e(t,r){throw r};var G=(typeof window==="undefined"?"undefined":zt(window))=="object";var e=typeof importScripts=="function";var W=(typeof qt==="undefined"?"undefined":zt(qt))=="object"&&zt(qt.versions)=="object"&&typeof qt.versions.node=="string";var t="";function H(e){if(o["locateFile"]){return o["locateFile"](e,t)}return t+e}var V,z,r,Y;if(G||e){if(e){t=self.location.href}else if(typeof document!="undefined"&&document.currentScript){t=document.currentScript.src}if(Vt){t=Vt}if(t.indexOf("blob:")!==0){t=t.substr(0,t.replace(/[?#].*/,"").lastIndexOf("/")+1)}else{t=""}{V=function e(t){var r=new XMLHttpRequest;r.open("GET",t,false);r.send(null);return r.responseText};if(e){r=function e(t){var r=new XMLHttpRequest;r.open("GET",t,false);r.responseType="arraybuffer";r.send(null);return new Uint8Array(r.response)}}z=function e(t,r,n){var i=new XMLHttpRequest;i.open("GET",t,true);i.responseType="arraybuffer";i.onload=function(){if(i.status==200||i.status==0&&i.response){r(i.response);return}n()};i.onerror=n;i.send(null)}}Y=function e(t){return document.title=t}}else{}var q=o["print"]||console.log.bind(console);var u=o["printErr"]||console.warn.bind(console);Object.assign(o,F);F=null;if(o["arguments"])N=o["arguments"];if(o["thisProgram"])j=o["thisProgram"];if(o["quit"])B=o["quit"];var X=4;var f;if(o["wasmBinary"])f=o["wasmBinary"];var K=o["noExitRuntime"]||true;if((typeof WebAssembly==="undefined"?"undefined":zt(WebAssembly))!="object"){g("no native wasm support detected")}var c;var J=false;var Z;function Q(e,t,r){var n=t+r;var i="";while(!(t>=n)){var a=e[t++];if(!a)return i;if(!(a&128)){i+=String.fromCharCode(a);continue}var o=e[t++]&63;if((a&224)==192){i+=String.fromCharCode((a&31)<<6|o);continue}var s=e[t++]&63;if((a&240)==224){a=(a&15)<<12|o<<6|s}else{a=(a&7)<<18|o<<12|s<<6|e[t++]&63}if(a<65536){i+=String.fromCharCode(a)}else{var u=a-65536;i+=String.fromCharCode(55296|u>>10,56320|u&1023)}}return i}function d(e,t){return e?Q(p,e,t):""}function $(e,t,r,n){if(!(n>0))return 0;var i=r;var a=r+n-1;for(var o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343){var u=e.charCodeAt(++o);s=65536+((s&1023)<<10)|u&1023}if(s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6;t[r++]=128|s&63}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12;t[r++]=128|s>>6&63;t[r++]=128|s&63}else{if(r+3>=a)break;t[r++]=240|s>>18;t[r++]=128|s>>12&63;t[r++]=128|s>>6&63;t[r++]=128|s&63}}t[r]=0;return r-i}function ee(e,t,r){return $(e,p,t,r)}function te(e){var t=0;for(var r=0;r<e.length;++r){var n=e.charCodeAt(r);if(n<=127){t++}else if(n<=2047){t+=2}else if(n>=55296&&n<=57343){t+=4;++r}else{t+=3}}return t}var l,h,p,v,n,y,m,re,ne;function ie(e){l=e;o["HEAP8"]=h=new Int8Array(e);o["HEAP16"]=v=new Int16Array(e);o["HEAP32"]=y=new Int32Array(e);o["HEAPU8"]=p=new Uint8Array(e);o["HEAPU16"]=n=new Uint16Array(e);o["HEAPU32"]=m=new Uint32Array(e);o["HEAPF32"]=re=new Float32Array(e);o["HEAPF64"]=ne=new Float64Array(e)}var ae=o["INITIAL_MEMORY"]||16777216;var oe;var se=[];var ue=[];var fe=[];var ce=false;function le(){if(o["preRun"]){if(typeof o["preRun"]=="function")o["preRun"]=[o["preRun"]];while(o["preRun"].length){pe(o["preRun"].shift())}}w(se)}function de(){ce=true;w(ue)}function he(){if(o["postRun"]){if(typeof o["postRun"]=="function")o["postRun"]=[o["postRun"]];while(o["postRun"].length){ye(o["postRun"].shift())}}w(fe)}function pe(e){se.unshift(e)}function ve(e){ue.unshift(e)}function ye(e){fe.unshift(e)}var i=0;var a=null;var b=null;function me(e){i++;if(o["monitorRunDependencies"]){o["monitorRunDependencies"](i)}}function be(e){i--;if(o["monitorRunDependencies"]){o["monitorRunDependencies"](i)}if(i==0){if(a!==null){clearInterval(a);a=null}if(b){var t=b;b=null;t()}}}function g(e){{if(o["onAbort"]){o["onAbort"](e)}}e="Aborted("+e+")";u(e);J=true;Z=1;e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);s(t);throw t}var ge="data:application/octet-stream;base64,";function _e(e){return e.startsWith(ge)}var _;_="mp4-encoder.wasm";if(!_e(_)){_=H(_)}function we(e){try{if(e==_&&f){return new Uint8Array(f)}if(r){return r(e)}throw"both async and sync fetching of the wasm failed"}catch(e){g(e)}}function Ee(){if(!f&&(G||e)){if(typeof fetch=="function"){return fetch(_,{credentials:"same-origin"}).then(function(e){if(!e["ok"]){throw"failed to load wasm binary file at '"+_+"'"}return e["arrayBuffer"]()}).catch(function(){return we(_)})}}return Promise.resolve().then(function(){return we(_)})}function Se(){var r={a:Mt};function t(e,t){var r=e.exports;o["asm"]=r;c=o["asm"]["x"];ie(c.buffer);oe=o["asm"]["B"];ve(o["asm"]["y"]);be("wasm-instantiate")}me("wasm-instantiate");function n(e){t(e["instance"])}function i(e){return Ee().then(function(e){return WebAssembly.instantiate(e,r)}).then(function(e){return e}).then(e,function(e){u("failed to asynchronously prepare wasm: "+e);g(e)})}function e(){if(!f&&typeof WebAssembly.instantiateStreaming=="function"&&!_e(_)&&typeof fetch=="function"){return fetch(_,{credentials:"same-origin"}).then(function(e){var t=WebAssembly.instantiateStreaming(e,r);return t.then(n,function(e){u("wasm streaming compile failed: "+e);u("falling back to ArrayBuffer instantiation");return i(n)})})}else{return i(n)}}if(o["instantiateWasm"]){try{var a=o["instantiateWasm"](r,t);return a}catch(e){u("Module.instantiateWasm callback failed with error: "+e);return false}}e().catch(s);return{}}function w(e){while(e.length>0){e.shift()(o)}}function Ae(e,t,r,n){g("Assertion failed: "+d(e)+", at: "+[t?d(t):"unknown filename",r,n?d(n):"unknown function"])}function Te(e,t,r,n,i){}function E(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}function ke(){var e=new Array(256);for(var t=0;t<256;++t){e[t]=String.fromCharCode(t)}Re=e}var Re=undefined;function S(e){var t="";var r=e;while(p[r]){t+=Re[p[r++]]}return t}var A={};var T={};var k={};var Pe=48;var Le=57;function Oe(e){if(undefined===e){return"_unknown"}e=e.replace(/[^a-zA-Z0-9_]/g,"$");var t=e.charCodeAt(0);if(t>=Pe&&t<=Le){return"_"+e}return e}function xe(e,t){e=Oe(e);return new Function("body","return function "+e+"() {\n"+'    "use strict";'+"    return body.apply(this, arguments);\n"+"};\n")(t)}function R(e,r){var t=xe(r,function(e){this.name=r;this.message=e;var t=new Error(e).stack;if(t!==undefined){this.stack=this.toString()+"\n"+t.replace(/^Error(:[^\n]*)?\n/,"")}});t.prototype=Object.create(e.prototype);t.prototype.constructor=t;t.prototype.toString=function(){if(this.message===undefined){return this.name}else{return this.name+": "+this.message}};return t}var De=undefined;function P(e){throw new De(e)}var Ce=undefined;function Ie(e){throw new Ce(e)}function Ue(n,t,i){n.forEach(function(e){k[e]=t});function r(e){var t=i(e);if(t.length!==n.length){Ie("Mismatched type converter count")}for(var r=0;r<n.length;++r){L(n[r],t[r])}}var a=new Array(t.length);var o=[];var s=0;t.forEach(function(e,t){if(T.hasOwnProperty(e)){a[t]=T[e]}else{o.push(e);if(!A.hasOwnProperty(e)){A[e]=[]}A[e].push(function(){a[t]=T[e];++s;if(s===o.length){r(a)}})}});if(0===o.length){r(a)}}function L(e,t){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!("argPackAdvance"in t)){throw new TypeError("registerType registeredInstance requires argPackAdvance")}var n=t.name;if(!e){P('type "'+n+'" must have a positive integer typeid pointer')}if(T.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations){return}else{P("Cannot register type '"+n+"' twice")}}T[e]=t;delete k[e];if(A.hasOwnProperty(e)){var i=A[e];delete A[e];i.forEach(function(e){return e()})}}function Me(e,n,i,a,o){var s=E(i);n=S(n);L(e,{name:n,fromWireType:function e(t){return!!t},toWireType:function e(t,r){return r?a:o},argPackAdvance:8,readValueFromPointer:function e(t){var r;if(i===1){r=h}else if(i===2){r=v}else if(i===4){r=y}else{throw new TypeError("Unknown boolean type size: "+n)}return this["fromWireType"](r[t>>s])},destructorFunction:null})}var O=[];var x=[{},{value:undefined},{value:null},{value:true},{value:false}];function Fe(e){if(e>4&&0===--x[e].refcount){x[e]=undefined;O.push(e)}}function Ne(){var e=0;for(var t=5;t<x.length;++t){if(x[t]!==undefined){++e}}return e}function je(){for(var e=5;e<x.length;++e){if(x[e]!==undefined){return x[e]}}return null}function Be(){o["count_emval_handles"]=Ne;o["get_first_emval"]=je}var D={toValue:function e(t){if(!t){P("Cannot use deleted val. handle = "+t)}return x[t].value},toHandle:function e(t){switch(t){case undefined:return 1;case null:return 2;case true:return 3;case false:return 4;default:{var r=O.length?O.pop():x.length;x[r]={refcount:1,value:t};return r}}}};function Ge(e){return this["fromWireType"](y[e>>2])}function We(e,t){t=S(t);L(e,{name:t,fromWireType:function e(t){var r=D.toValue(t);Fe(t);return r},toWireType:function e(t,r){return D.toHandle(r)},argPackAdvance:8,readValueFromPointer:Ge,destructorFunction:null})}function He(e,t){switch(t){case 2:return function(e){return this["fromWireType"](re[e>>2])};case 3:return function(e){return this["fromWireType"](ne[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function Ve(e,t,r){var n=E(r);t=S(t);L(e,{name:t,fromWireType:function e(t){return t},toWireType:function e(t,r){return r},argPackAdvance:8,readValueFromPointer:He(t,n),destructorFunction:null})}function ze(e,t){if(!(e instanceof Function)){throw new TypeError("new_ called with constructor type "+zt(e)+" which is not a function")}var r=xe(e.name||"unknownFunctionName",function(){});r.prototype=e.prototype;var n=new r;var i=e.apply(n,t);return i instanceof Object?i:n}function Ye(e){while(e.length){var t=e.pop();var r=e.pop();r(t)}}function qe(e,t,r,n,i){var a=t.length;if(a<2){P("argTypes array size mismatch! Must at least get return value and 'this' types!")}var o=t[1]!==null&&r!==null;var s=false;for(var u=1;u<t.length;++u){if(t[u]!==null&&t[u].destructorFunction===undefined){s=true;break}}var f=t[0].name!=="void";var c="";var l="";for(var u=0;u<a-2;++u){c+=(u!==0?", ":"")+"arg"+u;l+=(u!==0?", ":"")+"arg"+u+"Wired"}var d="return function "+Oe(e)+"("+c+") {\n"+"if (arguments.length !== "+(a-2)+") {\n"+"throwBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(a-2)+" args!');\n"+"}\n";if(s){d+="var destructors = [];\n"}var h=s?"destructors":"null";var p=["throwBindingError","invoker","fn","runDestructors","retType","classParam"];var v=[P,n,i,Ye,t[0],t[1]];if(o){d+="var thisWired = classParam.toWireType("+h+", this);\n"}for(var u=0;u<a-2;++u){d+="var arg"+u+"Wired = argType"+u+".toWireType("+h+", arg"+u+"); // "+t[u+2].name+"\n";p.push("argType"+u);v.push(t[u+2])}if(o){l="thisWired"+(l.length>0?", ":"")+l}d+=(f?"var rv = ":"")+"invoker(fn"+(l.length>0?", ":"")+l+");\n";if(s){d+="runDestructors(destructors);\n"}else{for(var u=o?1:2;u<t.length;++u){var y=u===1?"thisWired":"arg"+(u-2)+"Wired";if(t[u].destructorFunction!==null){d+=y+"_dtor("+y+"); // "+t[u].name+"\n";p.push(y+"_dtor");v.push(t[u].destructorFunction)}}}if(f){d+="var ret = retType.fromWireType(rv);\n"+"return ret;\n"}else{}d+="}\n";p.push(d);var m=ze(Function,p).apply(null,v);return m}function Xe(e,t,r){if(undefined===e[t].overloadTable){var n=e[t];e[t]=function(){if(!e[t].overloadTable.hasOwnProperty(arguments.length)){P("Function '"+r+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!")}return e[t].overloadTable[arguments.length].apply(this,arguments)};e[t].overloadTable=[];e[t].overloadTable[n.argCount]=n}}function Ke(e,t,r){if(o.hasOwnProperty(e)){if(undefined===r||undefined!==o[e].overloadTable&&undefined!==o[e].overloadTable[r]){P("Cannot register public name '"+e+"' twice")}Xe(o,e,e);if(o.hasOwnProperty(r)){P("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!")}o[e].overloadTable[r]=t}else{o[e]=t;if(undefined!==r){o[e].numArguments=r}}}function Je(e,t){var r=[];for(var n=0;n<e;n++){r.push(m[t+n*4>>2])}return r}function Ze(e,t,r){if(!o.hasOwnProperty(e)){Ie("Replacing nonexistant public symbol")}if(undefined!==o[e].overloadTable&&undefined!==r){o[e].overloadTable[r]=t}else{o[e]=t;o[e].argCount=r}}function Qe(e,t,r){var n=o["dynCall_"+e];return r&&r.length?n.apply(null,[t].concat(r)):n.call(null,t)}var C=[];function $e(e){var t=C[e];if(!t){if(e>=C.length)C.length=e+1;C[e]=t=oe.get(e)}return t}function et(e,t,r){if(e.includes("j")){return Qe(e,t,r)}var n=$e(t).apply(null,r);return n}function tt(e,t){var r=[];return function(){r.length=0;Object.assign(r,arguments);return et(e,t,r)}}function rt(e,t){e=S(e);function r(){if(e.includes("j")){return tt(e,t)}return $e(t)}var n=r();if(typeof n!="function"){P("unknown function pointer with signature "+e+": "+t)}return n}var nt=undefined;function it(e){var t=Bt(e);var r=S(t);I(t);return r}function at(e,t){var r=[];var n={};function i(e){if(n[e]){return}if(T[e]){return}if(k[e]){k[e].forEach(i);return}r.push(e);n[e]=true}t.forEach(i);throw new nt(e+": "+r.map(it).join([", "]))}function ot(r,n,e,t,i,a){var o=Je(n,e);r=S(r);i=rt(t,i);Ke(r,function(){at("Cannot call "+r+" due to unbound types",o)},n-1);Ue([],o,function(e){var t=[e[0],null].concat(e.slice(1));Ze(r,qe(r,t,null,i,a),n-1);return[]})}function st(e,t,r){switch(t){case 0:return r?function e(t){return h[t]}:function e(t){return p[t]};case 1:return r?function e(t){return v[t>>1]}:function e(t){return n[t>>1]};case 2:return r?function e(t){return y[t>>2]}:function e(t){return m[t>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function ut(e,t,r,n,i){t=S(t);if(i===-1){i=4294967295}var a=E(r);var o=function e(t){return t};if(n===0){var s=32-8*r;o=function e(t){return t<<s>>>s}}var u=t.includes("unsigned");var f=function e(t,r){};var c;if(u){c=function e(t,r){f(r,this.name);return r>>>0}}else{c=function e(t,r){f(r,this.name);return r}}L(e,{name:t,fromWireType:o,toWireType:c,argPackAdvance:8,readValueFromPointer:st(t,a,n!==0),destructorFunction:null})}function ft(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];var i=n[t];function a(e){e=e>>2;var t=m;var r=t[e];var n=t[e+1];return new i(l,n,r)}r=S(r);L(e,{name:r,fromWireType:a,argPackAdvance:8,readValueFromPointer:a},{ignoreDuplicateRegistrations:true})}function ct(e,t){t=S(t);var l=t==="std::string";L(e,{name:t,fromWireType:function e(t){var r=m[t>>2];var n=t+4;var i;if(l){var a=n;for(var o=0;o<=r;++o){var s=n+o;if(o==r||p[s]==0){var u=s-a;var f=d(a,u);if(i===undefined){i=f}else{i+=String.fromCharCode(0);i+=f}a=s+1}}}else{var c=new Array(r);for(var o=0;o<r;++o){c[o]=String.fromCharCode(p[n+o])}i=c.join("")}I(t);return i},toWireType:function e(t,r){if(r instanceof ArrayBuffer){r=new Uint8Array(r)}var n;var i=typeof r=="string";if(!(i||r instanceof Uint8Array||r instanceof Uint8ClampedArray||r instanceof Int8Array)){P("Cannot pass non-string to std::string")}if(l&&i){n=te(r)}else{n=r.length}var a=jt(4+n+1);var o=a+4;m[a>>2]=n;if(l&&i){ee(r,o,n+1)}else{if(i){for(var s=0;s<n;++s){var u=r.charCodeAt(s);if(u>255){I(o);P("String has UTF-16 code units that do not fit in 8 bits")}p[o+s]=u}}else{for(var s=0;s<n;++s){p[o+s]=r[s]}}}if(t!==null){t.push(I,a)}return a},argPackAdvance:8,readValueFromPointer:Ge,destructorFunction:function e(t){I(t)}})}function lt(e,t){var r="";for(var n=0;!(n>=t/2);++n){var i=v[e+n*2>>1];if(i==0)break;r+=String.fromCharCode(i)}return r}function dt(e,t,r){if(r===undefined){r=2147483647}if(r<2)return 0;r-=2;var n=t;var i=r<e.length*2?r/2:e.length;for(var a=0;a<i;++a){var o=e.charCodeAt(a);v[t>>1]=o;t+=2}v[t>>1]=0;return t-n}function ht(e){return e.length*2}function pt(e,t){var r=0;var n="";while(!(r>=t/4)){var i=y[e+r*4>>2];if(i==0)break;++r;if(i>=65536){var a=i-65536;n+=String.fromCharCode(55296|a>>10,56320|a&1023)}else{n+=String.fromCharCode(i)}}return n}function vt(e,t,r){if(r===undefined){r=2147483647}if(r<4)return 0;var n=t;var i=n+r-4;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343){var s=e.charCodeAt(++a);o=65536+((o&1023)<<10)|s&1023}y[t>>2]=o;t+=4;if(t+4>i)break}y[t>>2]=0;return t-n}function yt(e){var t=0;for(var r=0;r<e.length;++r){var n=e.charCodeAt(r);if(n>=55296&&n<=57343)++r;t+=4}return t}function mt(e,c,a){a=S(a);var l,o,d,s,h;if(c===2){l=lt;o=dt;s=ht;d=function e(){return n};h=1}else if(c===4){l=pt;o=vt;s=yt;d=function e(){return m};h=2}L(e,{name:a,fromWireType:function e(t){var r=m[t>>2];var n=d();var i;var a=t+4;for(var o=0;o<=r;++o){var s=t+4+o*c;if(o==r||n[s>>h]==0){var u=s-a;var f=l(a,u);if(i===undefined){i=f}else{i+=String.fromCharCode(0);i+=f}a=s+c}}I(t);return i},toWireType:function e(t,r){if(!(typeof r=="string")){P("Cannot pass non-string to C++ string type "+a)}var n=s(r);var i=jt(4+n+c);m[i>>2]=n>>h;o(r,i+4,n+c);if(t!==null){t.push(I,i)}return i},argPackAdvance:8,readValueFromPointer:Ge,destructorFunction:function e(t){I(t)}})}function bt(e,t){t=S(t);L(e,{isVoid:true,name:t,argPackAdvance:0,fromWireType:function e(){return undefined},toWireType:function e(t,r){return undefined}})}function gt(e,t){var r=T[e];if(undefined===r){P(t+" has unknown type "+it(e))}return r}function _t(e,t,r){e=D.toValue(e);t=gt(t,"emval::as");var n=[];var i=D.toHandle(n);m[r>>2]=i;return t["toWireType"](n,e)}function wt(e,t){var r=new Array(e);for(var n=0;n<e;++n){r[n]=gt(m[t+n*X>>2],"parameter "+n)}return r}function Et(e,t,r,n){e=D.toValue(e);var i=wt(t,r);var a=new Array(t);for(var o=0;o<t;++o){var s=i[o];a[o]=s["readValueFromPointer"](n);n+=s["argPackAdvance"]}var u=e.apply(undefined,a);return D.toHandle(u)}function St(e,t){e=D.toValue(e);t=D.toValue(t);return D.toHandle(e[t])}function At(e){if(e>4){x[e].refcount+=1}}function Tt(e){e=D.toValue(e);return typeof e=="number"}var kt={};function Rt(e){var t=kt[e];if(t===undefined){return S(e)}return t}function Pt(e){return D.toHandle(Rt(e))}function Lt(e){var t=D.toValue(e);Ye(t);Fe(e)}function Ot(e,t){e=gt(e,"_emval_take_value");var r=e["readValueFromPointer"](t);return D.toHandle(r)}function xt(){g("")}function Dt(e,t,r){p.copyWithin(e,t,t+r)}function Ct(){return 2147483648}function It(e){try{c.grow(e-l.byteLength+65535>>>16);ie(c.buffer);return 1}catch(e){}}function Ut(e){var t=p.length;e=e>>>0;var r=Ct();if(e>r){return false}var n=function e(t,r){return t+(r-t%r)%r};for(var i=1;i<=4;i*=2){var a=t*(1+.2/i);a=Math.min(a,e+100663296);var o=Math.min(r,n(Math.max(e,a),65536));var s=It(o);if(s){return true}}return false}ke();De=o["BindingError"]=R(Error,"BindingError");Ce=o["InternalError"]=R(Error,"InternalError");Be();nt=o["UnboundTypeError"]=R(Error,"UnboundTypeError");var Mt={b:Ae,q:Te,u:Me,t:We,o:Ve,f:ot,d:ut,c:ft,n:ct,l:mt,v:bt,j:_t,w:Et,a:Fe,e:St,h:At,p:Tt,g:Pt,i:Lt,k:Ot,m:xt,s:Dt,r:Ut};var Ft=Se();var Nt=o["___wasm_call_ctors"]=function(){return(Nt=o["___wasm_call_ctors"]=o["asm"]["y"]).apply(null,arguments)};var jt=o["_malloc"]=function(){return(jt=o["_malloc"]=o["asm"]["z"]).apply(null,arguments)};var I=o["_free"]=function(){return(I=o["_free"]=o["asm"]["A"]).apply(null,arguments)};var Bt=o["___getTypeName"]=function(){return(Bt=o["___getTypeName"]=o["asm"]["C"]).apply(null,arguments)};var Gt=o["__embind_initialize_bindings"]=function(){return(Gt=o["__embind_initialize_bindings"]=o["asm"]["D"]).apply(null,arguments)};var Wt=o["dynCall_ijiii"]=function(){return(Wt=o["dynCall_ijiii"]=o["asm"]["E"]).apply(null,arguments)};var U;b=function e(){if(!U)Ht();if(!U)b=e};function Ht(e){e=e||N;if(i>0){return}le();if(i>0){return}function t(){if(U)return;U=true;o["calledRun"]=true;if(J)return;de();M(o);if(o["onRuntimeInitialized"])o["onRuntimeInitialized"]();he()}if(o["setStatus"]){o["setStatus"]("Running...");setTimeout(function(){setTimeout(function(){o["setStatus"]("")},1);t()},1)}else{t()}}if(o["preInit"]){if(typeof o["preInit"]=="function")o["preInit"]=[o["preInit"]];while(o["preInit"].length>0){o["preInit"].pop()()}}Ht();return o.ready}}();var t=r.default=e;e.createFile=_;function _(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:256;var n=0;var i=0;var a=new Uint8Array(e);return{contents:function e(){return a.slice(0,i)},seek:function e(t){n=t},write:function e(t){var r=t.byteLength;o(n+r);a.set(t,n);n+=r;i=Math.max(i,n);return r}};function o(e){var t=a.length;if(t>=e)return;var r=1024*1024;e=Math.max(e,t*(t<r?2:1.125)>>>0);if(t!=0)e=Math.max(e,256);var n=a;a=new Uint8Array(e);if(i>0)a.set(n.subarray(0,i),0)}}function Yt(i){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var t=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var r=e.width,n=e.height,a=e.fps,o=a===void 0?30:a,s=e.fragmentation,u=s===void 0?false:s,f=e.sequential,c=f===void 0?false:f,l=e.hevc,d=l===void 0?false:l,h=e.audio_channel_count,p=h===void 0?0:h;if(typeof r!=="number"||typeof n!=="number"){throw new Error("Must specify { width, height } options")}if(!isFinite(r)||r<0||!isFinite(n)||n<0){throw new Error("{ width, height } options must be positive integers")}var v=_();var y=null;var m=0;if(p>0){m=t.byteLength;y=i._malloc(t.byteLength);i.HEAPU8.set(t,y)}var b=i.create_muxer({width:r,height:n,fps:o,fragmentation:u,sequential:c,hevc:d,audio_channel_count:p},g,y,m);if(y){i._free(y)}return{end:function e(){i.finalize_muxer(b);return v.contents()},addNalu:function e(t,r){var n=i._malloc(t.byteLength);i.HEAPU8.set(t,n);i.mux_nal(b,n,t.byteLength,r);i._free(n)},addAAC:function e(t,r){var n=i._malloc(t.byteLength);i.HEAPU8.set(t,n);i.mux_aac(b,n,t.byteLength,r);i._free(n)}};function g(e,t,r){v.seek(r);var n=i.HEAPU8.subarray(e,e+t);return v.write(n)!==n.byteLength}}}).call(this)}).call(this,e("_process"))},{_process:2}],28:[function(e,t,r){"use strict";if(typeof ArrayBuffer!=="undefined"&&!ArrayBuffer.prototype.slice){ArrayBuffer.prototype.slice=function(e,t){var r=new Uint8Array(this);if(t===undefined){t=r.length}var n=new ArrayBuffer(t-e);var i=new Uint8Array(n);for(var a=0;a<i.length;a++){i[a]=r[a+e]}return n}}},{}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,s(n.key),n)}}function o(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function s(e){var t=u(e,"string");return"symbol"==i(t)?t:String(t)}function u(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var c=["attribute vec4 vertexPos;","attribute vec2 texturePos;","varying vec2 textureCoord;","void main() {","    gl_Position = vertexPos;","    textureCoord = texturePos;","}"].join("\n");var l=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","const mat4 YUV2RGB = mat4(","    1.1643828125, 0, 1.59602734375, -.87078515625,","    1.1643828125, -.39176171875, -.81296875, .52959375,","    1.1643828125, 2.017234375, 0, -1.081390625,","    0, 0, 0, 1",");","void main(void) {","    highp float y = texture2D(ySampler,  textureCoord).r;","    highp float u = texture2D(uSampler,  textureCoord).r;","    highp float v = texture2D(vSampler,  textureCoord).r;","    gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n");function d(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.bindTexture(e.TEXTURE_2D,null);return t}var f=r.default=function(){function t(e){n(this,t);this.canvas=e;this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl");this.initGL()}o(t,[{key:"initGL",value:function e(){if(!this.gl){console.log("[ER] WebGL not supported.");return}var t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1);var r=t.createShader(t.VERTEX_SHADER);var n=t.createShader(t.FRAGMENT_SHADER);var i=t.createProgram();if(!(r&&n&&i)){console.warn("shaders create failed")}t.shaderSource(r,c);t.compileShader(r);if(!t.getShaderParameter(r,t.COMPILE_STATUS)){console.warn("Vertex shader failed to compile: ",t.getShaderInfoLog(r))}t.shaderSource(n,l);t.compileShader(n);if(!t.getShaderParameter(n,t.COMPILE_STATUS)){console.log("Fragment shader failed to compile: ",t.getShaderInfoLog(n))}t.attachShader(i,r);t.attachShader(i,n);t.linkProgram(i);if(!t.getProgramParameter(i,t.LINK_STATUS)){console.log("Program failed to compile: ",t.getProgramInfoLog(i))}t.useProgram(i);t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer());t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,1,-1,-1,1,-1,-1]),t.STATIC_DRAW);var a=t.getAttribLocation(i,"vertexPos");t.enableVertexAttribArray(a);t.vertexAttribPointer(a,2,t.FLOAT,false,0,0);t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer());t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,1,0,0,1,0,0]),t.STATIC_DRAW);var o=t.getAttribLocation(i,"texturePos");t.enableVertexAttribArray(o);t.vertexAttribPointer(o,2,t.FLOAT,false,0,0);this.yTexture=d(t);var s=t.getUniformLocation(i,"ySampler");t.uniform1i(s,0);this.uTexture=d(t);var u=t.getUniformLocation(i,"uSampler");t.uniform1i(u,1);this.vTexture=d(t);var f=t.getUniformLocation(i,"vSampler");t.uniform1i(f,2)}},{key:"renderFrame",value:function e(t,r,n,i,a,o,s){if(!this.gl){console.log("[ER] Render frame failed due to WebGL not supported.");return}var u=this.gl;var f=r*n;u.viewport(i,a,o,s);var c=f;var l=t.subarray(0,c);u.activeTexture(u.TEXTURE0);u.bindTexture(u.TEXTURE_2D,this.yTexture);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,r,n,0,u.LUMINANCE,u.UNSIGNED_BYTE,l);var d=f/4;var h=t.subarray(c,c+d);u.activeTexture(u.TEXTURE1);u.bindTexture(u.TEXTURE_2D,this.uTexture);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,r/2,n/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,h);var p=d;var v=t.subarray(c+d,c+d+p);u.activeTexture(u.TEXTURE2);u.bindTexture(u.TEXTURE_2D,this.vTexture);u.texImage2D(u.TEXTURE_2D,0,u.LUMINANCE,r/2,n/2,0,u.LUMINANCE,u.UNSIGNED_BYTE,v);u.drawArrays(u.TRIANGLES,0,6)}},{key:"fullscreen",value:function e(){var t=this.canvas;if(t.RequestFullScreen){t.RequestFullScreen()}else if(t.webkitRequestFullScreen){t.webkitRequestFullScreen()}else if(t.mozRequestFullScreen){t.mozRequestFullScreen()}else if(t.msRequestFullscreen){t.msRequestFullscreen()}else{alert("This browser doesn't supporter fullscreen")}}},{key:"exitfullscreen",value:function e(){if(document.exitFullscreen){document.exitFullscreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else{alert("Exit fullscreen doesn't work")}}},{key:"setSize",value:function e(t,r,n){var i=Math.min(n,t);this.canvas.width=i;this.canvas.height=i*r/t}}]);return t}()},{}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:true});r.default=void 0;var n=e("./errors");var f=a(e("./events"));var i=a(e("./controller/flow-controller"));var o=a(e("./controller/buffer-controller"));var s=a(e("events"));var c=a(e("./loader/websocket-loader"));function a(e){return e&&e.__esModule?e:{default:e}}function u(e){"@babel/helpers - typeof";return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,p(n.key),n)}}function h(e,t,r){if(t)d(e.prototype,t);if(r)d(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function p(e){var t=v(e,"string");return"symbol"==u(t)?t:String(t)}function v(e,t){if("object"!=u(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var y=function(){function u(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};l(this,u);var t=u.DefaultConfig;for(var r in t){if(r in e){continue}e[r]=t[r]}this.config=e;var a=this.observer=new s.default;a.trigger=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++){n[i-1]=arguments[i]}a.emit.apply(a,[t,t].concat(n))};a.off=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++){n[i-1]=arguments[i]}a.removeListener.apply(a,[t].concat(n))};this.on=a.on.bind(a);this.off=a.off.bind(a);this.trigger=a.trigger.bind(a);this.flowController=new i.default(this);this.bufferController=new o.default(this);this.websocketLoader=new c.default(this);this.mediaType=undefined;this.extraData=undefined;this.audioInfo={client:null,websocketName:"",mediaType:"aac",sampleRate:16e3,numChannels:this.aenc_num_channels,bitWidth:this.aenc_bit_width}}h(u,[{key:"destroy",value:function e(){console.log("wfs destroy +++");this.flowController.destroy();this.bufferController.destroy();this.websocketLoader.destroy();console.log("wfs destroy ---")}},{key:"attachMedia",value:function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"chX";var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"H264Raw";var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"play2";var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:undefined;var o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:undefined;this.mediaType=n;this.media=t;this.extraData=a;this.audioInfo=o;var s=undefined;switch(n){case"MJPEG":s=f.default.MEDIA_ATTACHED;break;case"H265Raw":if(u.isSupportedHEVC()){s=f.default.MEDIA_ATTACHING}else{s=f.default.MEDIA_ATTACHED}break;case"H264Raw":default:s=f.default.MEDIA_ATTACHING;break}this.trigger(s,{media:t,mediaType:n,websocketName:i,extraData:this.extraData,audioInfo:this.audioInfo})}},{key:"attachWebsocket",value:function e(t,r){console.log("attachWebsocket: mediaType="+this.mediaType);this.trigger(f.default.WEBSOCKET_ATTACHING,{websocket:t,media:this.media,mediaType:this.mediaType,extraData:this.extraData,audioInfo:r})}},{key:"start_recording",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1*(1024*1024*1024);var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:undefined;this.trigger(f.default.RECORDING_START,{rec_file_threshold:t,result_cb:r,state_cb:n})}},{key:"playerSeekNow",value:function e(){this.trigger(f.default.PLAYER_SEEK_NOW)}},{key:"stop_recording",value:function e(){this.trigger(f.default.RECORDING_STOP)}}],[{key:"version",get:function e(){return""+"v.0.0.0.1"}},{key:"isSupported",value:function e(){return window.MediaSource&&typeof window.MediaSource.isTypeSupported==="function"&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42c01f,mp4a.40.2"')}},{key:"isSupportedHEVC",value:function e(){return window.MediaSource&&typeof window.MediaSource.isTypeSupported==="function"&&window.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"')}},{key:"canPlayByVideo",value:function e(t){var r=true;if(t==="MJPEG"){r=false}else if(t==="H265Raw"){r=u.isSupportedHEVC()}return r}},{key:"Events",get:function e(){return f.default}},{key:"ErrorTypes",get:function e(){return n.ErrorTypes}},{key:"ErrorDetails",get:function e(){return n.ErrorDetails}},{key:"DefaultConfig",get:function e(){if(!u.defaultConfig){u.defaultConfig={debug:false,videoReady:false,audioReady:false,forceKeyFrameOnDiscontinuity:true,appendErrorMaxRetry:3,wsMinPacketInterval:3e3,wsMaxPacketInterval:3e4,mode:"both",mp4Duration:1e3,fps:30,timescale:9e4,recording:false,liveMaxLatency:.5,audioCodecs:"mp4a.40.2"}}return u.defaultConfig},set:function e(t){u.defaultConfig=t}}]);return u}();var m=r.default=y},{"./controller/buffer-controller":8,"./controller/flow-controller":9,"./errors":12,"./events":14,"./loader/websocket-loader":22,events:1}]},{},[21])(21)});